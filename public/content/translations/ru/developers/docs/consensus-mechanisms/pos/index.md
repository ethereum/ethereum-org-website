---
title: Доказательство владения (PoS)
description: Пояснення протоколу консенсусу proof-of-work та його ролі в Ethereum.
lang: ru
---

Доказательство владения (PoS) лежит в основе [механизма консенсуса](/developers/docs/consensus-mechanisms/) Ethereum. В 2022 году Ethereum перешел на механизм доказательства владения, потому что он более безопасен, менее энергоемок и лучше подходит для реализации новых решений для масштабирования по сравнению с предыдущей архитектурой [доказательства работы](/developers/docs/consensus-mechanisms/pow).

## Предварительные условия {#prerequisites}

Чтобы лучше понять эту страницу, мы рекомендуем вам сначала ознакомиться с [механизмами консенсуса](/developers/docs/consensus-mechanisms/).

## Что такое доказательство владения (PoS)? {#what-is-pos}

Доказательство доли — это способ подтвердить, что валидаторы поставили на кон некоторую ценность, и сеть сможет уничтожить её, если они поведут себя нечестно. В доказательстве доли Ethereum валидаторы открыто замораживают в смарт-контракт свой ETH капитал. После этого валидатор является ответственным за проверку того, что новые блоки, распространяющиеся по сети, являются действительными, и время от времени создает и распространяет новые блоки сам. Если они попытаются обмануть сеть (например: предлагая несколько блоков, когда должны были отправить один, чтобы создать конфликты), некоторая часть их ETH из стейка может быть уничтожена.

## Валидаторы {#validators}

Для участия в качестве валидатора пользователь должен вложить 32 ETH на депозитный контракт и запустить три отдельных компонента программного обеспечения: клиента выполнения, клиента консенсуса и клиента валидатора. При внесении своих ETH, пользователь присоединяется к очереди активации, которая ограничивает скорость присоединения новых валидаторов к сети. После активации валидаторы получают новые блоки от собратьев сети Ethereum. Транзакции в поступающем блоке выполняются повторно, чтобы проверить и убедиться, что предложенные изменения в текущее состояние Ethereum реальны, и подпись, принадлежащая блоку — проверена. Затем валидатор отправляет голос (называемый аттестацией) в пользу этого блока по всей сети.

В то время как в proof-of-work время создания блоков определяется сложностью майнинга, в proof-of-stake темп фиксирован. Время в Ethereum с протоколом proof-of-stake разделено на слоты (12 секунд) и эпохи (32 слота). В каждом слоте случайным образом выбирается один валидатор, предлагающий блок. Этот валидатор отвечает за создание нового блока и отправку его другим узлам сети. Также в каждом слоте случайно выбирается комитет валидаторов, чьи голоса используются для определения правильности предложенного блока. Разделение валидаторов на подгруппы (комитеты) важно, чтобы нагрузка на сеть была распределённой и легко управляемой. Комитеты разделяют валидаторов так, чтобы каждый активный валидатор поучаствовал в верификации каждой эпохи, но не каждого слота.

## Как выполняется транзакция в Ethereum PoS {#transaction-execution-ethereum-pos}

Ниже приводится подробное объяснение того, как выполняется транзакция в Ethereum proof-of-stake.

1. Пользователь создает и подписывает [транзакцию](/developers/docs/transactions/) своим закрытым ключом. Обычно это обрабатывается кошельком или библиотекой, такой как [ethers.js](https://docs.ethers.org/v6/), [web3js](https://docs.web3js.org/), [web3py](https://web3py.readthedocs.io/en/v5/) и т. д., но под капотом пользователь делает запрос к узлу, используя Ethereum [JSON-RPC API](/developers/docs/apis/json-rpc/). Пользователь определяет сумму газа, которую он готов заплатить, как чаевые контролёру для поощрения его за включение транзакции в блок. [Чаевые](/developers/docs/gas/#priority-fee) выплачиваются валидатору, а [базовая комиссия](/developers/docs/gas/#base-fee) сжигается.
2. Транзакция отправляется [клиенту-исполнителю](/developers/docs/nodes-and-clients/#execution-client) Ethereum, который проверяет ее действительность. Это означает, что отправитель имеет достаточно ETH для выполнения транзакции, и он подписал ее правильным ключом.
3. Если транзакция достоверна, клиент-исполнитель добавляет ее в свой локальный пул памяти (список ожидающих транзакций) и передает ее другим узлам через сеть сплетен уровня выполнения. Когда другие узлы слышат о транзакции, они также добавляют ее в свои локальные пулы памяти. Продвинутые пользователи могут воздержаться от трансляции своей транзакции и вместо этого направить ее специализированным сборщикам блоков, таким как [Flashbots Auction](https://docs.flashbots.net/flashbots-auction/overview). Это позволяет им организовывать транзакции в предстоящих блоках для получения максимальной прибыли ([MEV](/developers/docs/mev/#mev-extraction)).
4. . Этот узел отвечает за построение и трансляцию следующего блока, который должен быть добавлен в блокчейн Ethereum, и обновление глобального состояния. Узел состоит из трех частей: клиент-исполнитель, консенсус-клиент и клиент-валидатор. Клиент-исполнитель объединяет транзакции из локального пула памяти в "полезную нагрузку для выполнения" и выполняет их локально, чтобы сгенерировать изменение состояния. Эта информация передается клиенту соглашения, где полезная нагрузка для исполнения упаковывается, как часть "блока маяка", который также содержит информацию о вознаграждениях, штрафах, сокращениях, аттестации и так далее, что позволяет сети согласовывать последовательность блоков в начале цепи. Связь между клиентами-исполнителями и клиентами консенсуса более подробно описана в разделе [Подключение клиентов консенсуса и клиентов-исполнителей](/developers/docs/networking-layer/#connecting-clients).
5. Другие узлы получают новые блоки маяков в сети сплетен на уровне консенсуса. Они передают его клиенту исполнения, где транзакции повторно выполняются локально, чтобы убедиться, что предлагаемое изменение состояния является действительным. Затем клиент-валидатор подтверждает, что блок действителен и является логическим следующим блоком в его представлении цепочки (это означает, что он построен на цепочке с наибольшим весом аттестаций, как определено в [правилах выбора форка](/developers/docs/consensus-mechanisms/pos/#fork-choice)). Блок добавляется в локальную базу данных каждого узла, который это подтверждает.
6. Транзакция считается «финализированной», если она становится частью сети в «связи с супербольшинством» между двумя чекпоинтами. Чекпоинты появляются в начале каждой эпохи и существуют для учёта того, что: только часть активных валидаторов утверждает каждый слот, и что все активные валидаторы поучаствовали в утверждении каждой эпохи. «Связь супербольшинства» раскрывается только между эпохами, чтобы убедиться, что 66% всех застейканных ETH в сети согласились с состоянием двух чекпоинтов.

Более подробную информацию о завершенности можно найти ниже.

## Финальность {#finality}

В распределённых сетях транзакция считается «финализированной», когда она становится частью блока, который не может быть изменён без сжигания большого количества ETH. В Ethereum proof-of-stake управляется с использованием "контрольных точек" блоков. Первый блок в кажой эпохе является контрольной точкой. Валидаторы голосуют за пары контрольных точек, которые они считают действительными. Если пара контрольных точек набирает голоса, представляющие по крайней мере две трети всего поставленного ETH, контрольные точки обновлены. Более новые из двух (целевого назначения) становятся "оправданными". Ранние две уже оправданы, потому что они были целью в предыдущей эпохе. Теперь он обновлен до "завершено". Этот процесс обновления контрольных точек обрабатывается **[Casper the Friendly Finality Gadget (Casper-FFG)](https://arxiv.org/pdf/1710.09437)**. Casper-FFG — это инструмент консенсуса для финализации блоков. После финализации блок не может быть отменен или изменен без слэшинга большинства дольщиков, что делает это экономически невыгодным.

Для отмены завершенного блока, атакующий должен взять на себя обязательство лишиться как минимум одной трети от всего общего объема поставленного ETH. Точная причина этого объясняется в этой [статье блога Ethereum Foundation](https://blog.ethereum.org/2016/05/09/on-settlement-finality/). Поскольку завершение требует большинства в две трети, злоумышленник может помешать сети достичь завершенности путем голосования за одну треть общей доли. Для защиты от этого существует механизм: [утечка неактивности](https://eth2book.info/bellatrix/part2/incentives/inactivity). Он включается всякий раз, когда цепочка терпит неудачу в завершении в течение более, чем четырех эпох. Бездействие постепенно расходует заложенный ETH валидаторов, которые голосуют против большинства голосов, в результате чего большинство валидаторов восстанавливают большинство в две трети голосов и завершают цепочку.

## Криптоэкономическая безопасность {#crypto-economic-security}

Запуск валидатора является обязательством. Ожидается, что валидатор будет поддерживать достаточное оборудование и возможность подключения для участия в проверке блоков и предложения. Взамен валидатору выплачивается ETH (их поставленный баланс увеличивается). С другой стороны, участие в качестве валидатора также открывает для пользователей новые возможности для атаки сети ради личной выгоды или саботажа. Для предотвращения этого валидаторы пренебрегают ETH вознаграждениями, если они не участвуют, когда их вызывают, и их существующая ставка может быть ликвидирована, если они ведут себя нечестно. Два основных поступка могут считаться нечестными: предложение нескольких блоков в одном слоте (раздвоение) и подтверждение противоречивых доказательств.

Количество ETH сокращается, в зависимости от того, как много валидаторов также сокращается примерно в то же время. Это известно как [«штраф за корреляцию»](https://eth2book.info/bellatrix/part2/incentives/slashing#the-correlation-penalty), и он может быть незначительным (~1 % доли для одного валидатора, подвергшегося слэшингу в одиночку) или может привести к уничтожению 100 % доли валидатора (событие массового слэшинга). Он навязывается в середине периода принудительного выхода, который начинается с немедленного штрафа (до 1 ETH) в первый день, и заканчивается изгнанием из сети на тридцать шестой день. Они получают незначительные штрафные санкции каждый день, потому что находятся в сети, но не голосуют. Все это означает, что скоординированная атака обойдется злоумышленнику очень дорого.

## Выбор форка {#fork-choice}

Когда сеть работает оптимально и честно, во главе цепочки всегда находится только один новый блок, и все валидаторы подтверждают это. Однако, возможно, что валидаторы имеют разные взгляды на главу цепочки из-за задержки в сети или потому, что предложивший блок был двусмысленен. Таким образом, консенсусным клиентам нужен алгоритм, чтобы решить, кому из них отдать предпочтение. Алгоритм, используемый в Ethereum с доказательством владения, называется [LMD-GHOST](https://arxiv.org/pdf/2003.03052.pdf) и работает путем определения форка, который имеет наибольший вес аттестаций в своей истории.

## Доказательство владения и безопасность {#pos-and-security}

Угроза [атаки 51 %](https://www.investopedia.com/terms/1/51-attack.asp) по-прежнему существует при использовании доказательства владения, как и при доказательстве работы, но для злоумышленников она еще более рискованна. Атакующему потребуется 51% поставленного ETH. Затем они могут использовать свое собственное одобрение, чтобы убедиться, что их предпочтительная вилка имеет наибольшее количество накопленных утверждений. 'Вес' накопленных подтверждений - это то, что консенсусные клиенты используют для определения правильной цепочки, итак, этот злоумышленник сможет сделать свою вилку канонической. Однако, сила proof-of-stake над proof-of-work в том, что сообщество имеет гибкие возможности в организации контратаки. Например, честные валидаторы могли бы принять решение о продолжении стройки по меньшей цепочке и игнорировать ветку злоумышленника, пока поощряющие приложения, биржи, и пулы выполняют то же самое. Они могут также решить принудительно удалить атакующего из сети и ликвидировать поставленный им ETH. Это сильная экономическая защита от атаки 51%.

:

- атаки на дальние дистанции (хотя гаджет финальности нейтрализует этот вектор атаки)
- «короткие реорганизации (риорги)»\*\* (хотя механизмы proposer boosting и дедлайны аттестаций смягчают эту проблему).
- russian
- лавинные атаки (нейтрализуются правилом алгоритмов выбора вилки, рассматривающих только последнее сообщение)

В целом, доказательство доли, как оно реализовано в Ethereum, было продемонстрировано как более экономически безопасное, чем доказательство работы.

## Преимущества и недостатки {#pros-and-cons}

| Преимущества                                                                                                                                                                                                                                                                        | Недостатки                                                                                                                        |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| Стакинг облегчает участие отдельных лиц в обеспечении безопасности сети, способствуя децентрализации. узел валидатора может быть запущен на обычном ноутбуке. Ставочные пулы позволяют пользователям делать ставки, не имея 32 ETH. | Proof-of-stake является более молодым и менее испытанным в боях по сравнению с proof-of-work                                      |
| Стейкинг более децентрализован. Экономия от масштаба не действует так же, как при добыче PoW.                                                                                                                                                       | Proof-of-stake сложнее в реализации, чем proof-of-work                                                                            |
| Proof-of-stake обеспечивает большую крипто-экономическую безопасность, чем proof-of-work                                                                                                                                                                                            | Для участия в доказательстве доли Ethereum пользователям необходимо запустить три части программного обеспечения. |
| Для стимулирования участников сети требуется уменьшить выпуск нового ETH                                                                                                                                                                                                            |                                                                                                                                   |

### Сравнение с доказательством работы {#comparison-to-proof-of-work}

Ethereum изначально использовал доказательство работоспособности, но переключился на доказательство доли владения в Сентябре 2022. PoS обладает некоторыми преимуществами над PoW, такими как:

- повышение энергоэффективности - нет необходимости использовать много энергии на вычисления proof-of-work
- ниже порог для входа, уменьшение требований к оборудованию - нет необходимости в дорогом оборудовании, чтобы иметь шанс на создание новых блоков
- снижение риска централизации - proof-of-stake должен привести к увеличению числа узлов, обеспечивающих безопасность сети
- в связи со снижением энергопотребления необходимо выпускать меньше ETH для стимулирования участия
- штрафы за нечестное поведение делают атаки 51% более дорогостоящими для атакующего, в сравнении с доказательством работы
- сообщество может обратиться к социальному восстановлению честной цепочки, если атака 51% преодолеет криптоэкономическую защиту.

## Дополнительные материалы {#further-reading}

- [FAQ по доказательству владения](https://vitalik.eth.limo/general/2017/12/31/pos_faq.html) _Виталик Бутерин_
- [Что такое доказательство владения](https://consensys.net/blog/blockchain-explained/what-is-proof-of-stake/) _ConsenSys_
- [Что такое доказательство владения и почему это важно](https://bitcoinmagazine.com/culture/what-proof-of-stake-is-and-why-it-matters-1377531463) _Виталик Бутерин_
- [Почему доказательство владения (ноябрь 2020 г.)](https://vitalik.eth.limo/general/2020/11/06/pos2020.html) _Виталик Бутерин_
- [Доказательство владения: как я полюбил слабую субъективность](https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/) _Виталик Бутерин_
- [Атака и защита Ethereum на основе доказательства владения](https://mirror.xyz/jmcook.eth/YqHargbVWVNRQqQpVpzrqEQ8IqwNUJDIpwRP7SS5FXs)
- [Философия дизайна доказательства владения](https://medium.com/@VitalikButerin/a-proof-of-stake-design-philosophy-506585978d51) _Виталик Бутерин_
- [Видео: Виталик Бутерин объясняет Лексу Фридману, что такое доказательство владения](https://www.youtube.com/watch?v=3yrqBG-7EVE)

## Смежные темы {#related-topics}

- [Доказательство работы](/developers/docs/consensus-mechanisms/pow/)
- [Доказательство полномочий](/developers/docs/consensus-mechanisms/poa/)

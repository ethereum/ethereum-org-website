---
title: Стандарт мульти-токенов ERC-1155
description: Узнайте о ERC-1155 — стандарте нескольких токенов, который объединяет взаимозаменяемые и невзаимозаменяемые токены в одном контракте.
lang: ru
---

## Введение {#introduction}

Стандартный интерфейс для контрактов, которые управляют несколькими типами токенов. Один развернутый контракт может включать любую комбинацию взаимозаменяемых токенов, невзаимозаменяемых токенов или других конфигураций (например, полувзаимозаменяемых токенов).

**Что значит стандарт мульти-токена?**

Идея проста и предназначена для создания интерфейса смарт-контракта, который может представлять и контролировать любое количество токенов взаимозаменяемых и невзаимозаменяемых типов. Таким образом, токен ERC-1155 может выполнять те же функции, что и токены [ERC-20](/developers/docs/standards/tokens/erc-20/) и [ERC-721](/developers/docs/standards/tokens/erc-721/), и даже обе одновременно. Это повышает функциональность стандартов ERC-20 и ERC-721, что делает их более эффективными и исправляет очевидные ошибки реализации.

Токен ERC-1155 полностью описан в [EIP-1155](https://eips.ethereum.org/EIPS/eip-1155).

## Предварительные условия {#prerequisites}

Чтобы лучше понять эту страницу, мы рекомендуем сначала прочитать о [стандартах токенов](/developers/docs/standards/tokens/), [ERC-20](/developers/docs/standards/tokens/erc-20/) и [ERC-721](/developers/docs/standards/tokens/erc-721/).

## Функции и возможности ERC-1155: {#body}

- [Пакетная передача](#batch_transfers): Передача нескольких активов в одном вызове.
- [Пакетный баланс](#batch_balance): Получение балансов нескольких активов за один вызов.
- [Пакетное одобрение](#batch_approval): Одобрение всех токенов для одного адреса.
- [Хуки](#receive_hook): Хук получения токенов.
- [Поддержка NFT](#nft_support): Если объем эмиссии равен 1, токен считается NFT.
- [Правила безопасной передачи](#safe_transfer_rule): Набор правил для безопасной передачи.

### Пакетные передачи {#batch-transfers}

Перевод партией работает почти так же, как и обычные ERC-20 переводы. Давайте рассмотрим обычную функцию `transferFrom` стандарта ERC-20:

```solidity
// ERC-20
function transferFrom(address from, address to, uint256 value) external returns (bool);

// ERC-1155
function safeBatchTransferFrom(
    address _from,
    address _to,
    uint256[] calldata _ids,
    uint256[] calldata _values,
    bytes calldata _data
) external;
```

Единственное различие в ERC-1155 заключается в том, что мы передаем значения в виде массива и также передаем массив идентификаторов. Например, если `ids=[3, 6, 13]` и `values=[100, 200, 5]`, то в результате будут выполнены следующие передачи:

1. Передача 100 токенов с ID 3 от `_from` к `_to`.
2. Передача 200 токенов с ID 6 от `_from` к `_to`.
3. Передача 5 токенов с ID 13 от `_from` к `_to`.

В ERC-1155 есть только `transferFrom`, но нет `transfer`. Чтобы использовать ее как обычную функцию `transfer`, просто укажите в качестве адреса отправителя адрес, вызывающий функцию.

### Пакетный баланс {#batch-balance}

Соответствующий вызов `balanceOf` в ERC-20 также имеет парную функцию с поддержкой пакетной обработки. В качестве напоминания версия ERC-20:

```solidity
// ERC-20
function balanceOf(address owner) external view returns (uint256);

// ERC-1155
function balanceOfBatch(
    address[] calldata _owners,
    uint256[] calldata _ids
) external view returns (uint256[] memory);
```

Даже проще, чем запрос баланса, мы можем получить несколько балансов за один запрос. Мы передаем массив владельцев, а затем массив идентификаторов токенов.

Например, если `_ids=[3, 6, 13]` и `_owners=[0xbeef..., 0x1337..., 0x1111...]`, возвращаемое значение будет:

```solidity
[
    balanceOf(0xbeef...),
    balanceOf(0x1337...),
    balanceOf(0x1111...)
]
```

### Пакетное одобрение {#batch-approval}

```solidity
// ERC-1155
function setApprovalForAll(
    address _operator,
    bool _approved
) external;

function isApprovedForAll(
    address _owner,
    address _operator
) external view returns (bool);
```

Утверждения немного отличаются от ERC-20. Вместо одобрения определенных сумм вы устанавливаете оператора как одобренного или неодобренного с помощью `setApprovalForAll`.

Проверить текущий статус можно с помощью `isApprovedForAll`. Как вы видите, это операция "все или ничего". Вы не можете выбрать количество токенов для утверждения или даже класс токенов.

Это сделано намеренно для простоты. Вы можете одобрить все только для одного адреса.

### Хук получения {#receive-hook}

```solidity
function onERC1155BatchReceived(
    address _operator,
    address _from,
    uint256[] calldata _ids,
    uint256[] calldata _values,
    bytes calldata _data
) external returns(bytes4);
```

Благодаря поддержке [EIP-165](https://eips.ethereum.org/EIPS/eip-165), ERC-1155 поддерживает хуки получения только для умных контрактов. Функция-хук должна возвращать предопределенное «магическое» значение типа bytes4, которое задается как:

```solidity
bytes4(keccak256("onERC1155BatchReceived(address,address,uint256[],uint256[],bytes)"))
```

Когда принимающий контракт возвращает это значение, считается, что контракт принимает передачу и знает, как обрабатывать токены ERC-1155. Отлично, токены больше не будут застревать в контракте!

### Поддержка NFT {#nft-support}

Если объем предложения равен единице, то токен по сути является невзаимозаменяемым (NFT). Как и в стандарте ERC-721, вы можете задать URL метаданных. URL-адрес может считываться и изменяться клиентами, см. [здесь](https://eips.ethereum.org/EIPS/eip-1155#metadata).

### Правило безопасной передачи {#safe-transfer-rule}

Мы уже коснулись нескольких правил безопасного перевода в предыдущих объяснениях. Но давайте взглянем на самые важные из правил:

1. Вызывающий должен иметь разрешение на расходование токенов с адреса `_from` или вызывающий должен быть равен `_from`.
2. Вызов передачи должен быть отменен, если:
   1. адрес `_to` равен 0.
   2. длина `_ids` не совпадает с длиной `_values`.
   3. любой из балансов держателя(-ей) токена(-ов) из `_ids` меньше соответствующего количества из `_values`, отправляемого получателю.
   4. происходит любая другая ошибка.

_Примечание_: все пакетные функции, включая хук, также существуют в версиях без пакетной обработки. Это сделано для эффективности расходования газа, поскольку передача одного актива, скорее всего, останется наиболее распространенным способом. Мы опустили их для простоты объяснения, включая правила безопасной передачи. Названия идентичны, просто уберите слово «Batch».

## Дополнительные материалы {#further-reading}

- [EIP-1155: стандарт нескольких токенов](https://eips.ethereum.org/EIPS/eip-1155)
- [ERC-1155: документация OpenZeppelin](https://docs.openzeppelin.com/contracts/5.x/erc1155)
- [ERC-1155: репозиторий на GitHub](https://github.com/enjin/erc-1155)
- [Alchemy NFT API](https://www.alchemy.com/docs/reference/nft-api-quickstart)

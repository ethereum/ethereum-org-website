---
title: Газ и комиссии
metaTitle: "Газ и комиссии в Ethereum: технический обзор"
description: Узнайте о комиссиях за газ в Ethereum, о том, как они рассчитываются, и об их роли в безопасности сети и обработке транзакций.
lang: ru
---

Газ необходим сети Ethereum. Это топливо, которое поддерживает его работу, словно бензин для автомобиля.

## Предварительные условия {#prerequisites}

Чтобы лучше понять эту страницу, мы рекомендуем вам сначала прочесть о [транзакциях](/developers/docs/transactions/) и [EVM](/developers/docs/evm/).

## Что такое газ? {#what-is-gas}

Газ — это единица для измерения объема вычислительных усилий, необходимых для выполнения определенных операций в сети Ethereum.

Поскольку каждая транзакция в Ethereum требует вычислительных ресурсов для исполнения, эти ресурсы должны быть оплачены, чтобы убедиться, что Ethereum устойчив к спаму и не застрянет в бесконечном цикле вычислений. Плата за вычисления происходит в виде комиссии за газ.

Комиссия за газ — это **количество газа, использованного для выполнения определенной операции, умноженное на стоимость единицы газа**. Комиссия платится независимо от того, состоится транзакция или провалится.

![Схема, показывающая, где необходим газ в операциях EVM](./gas.png)
_Схема адаптирована из [Ethereum EVM illustrated](https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf)_

Газ должен оплачиваться базовой валютой в Ethereum — эфиром (ETH). Зачастую цена газа называется в gwei, что является деноминацией ETH. Одна единица gwei — это одна миллиардная часть от целого ETH (0,000000001 ETH, 10<sup>-9</sup> ETH).

Например, вместо того, чтобы говорить, что ваш газ стоит 0,000000001 эфира, вы можете сказать, что ваш газ стоит 1 gwei.

Слово gwei происходит от слова giga-wei, то есть «миллиард wei». Один gwei равен миллиарду wei. Сам Wei (назван в честь [Вэй Дая](https://wikipedia.org/wiki/Wei_Dai), создателя [b-money](https://www.investopedia.com/terms/b/bmoney.asp)) — это наименьшая единица ETH.

## Как вычислить комиссию за газ? {#how-are-gas-fees-calculated}

Вы можете указать количество газа, который хотите заплатить, когда отправляете транзакцию. Предлагая определенное количество газа, вы делаете ставку на то, что ваша транзакция будет включена в следующий блок. Если вы предложите слишком мало, валидаторы с малой долей вероятности предпочтут включать эту транзакцию в блок, так что она может быть включена позже или даже никогда. Если вы предложите слишком много, то потратите какое-то количество ETH зря. Так как же узнать, сколько нужно заплатить?

Общая сумма газа, которую вы платите, делится на две составляющие: `базовая комиссия` и `комиссия за приоритет` (чаевые).

`Базовая комиссия` устанавливается протоколом — вы должны заплатить как минимум эту сумму, чтобы ваша транзакция считалась действительной. `Комиссия за приоритет` — это чаевые, которые вы добавляете к базовой комиссии, чтобы сделать вашу транзакцию привлекательной для валидаторов, чтобы они выбрали ее для включения в следующий блок.

Транзакция, которая оплачивает только `базовую комиссию`, технически действительна, но вряд ли будет включена, поскольку не дает валидаторам стимула выбирать ее вместо любой другой транзакции. «Правильная» `комиссия за приоритет` определяется загруженностью сети в момент отправки транзакции — если спрос большой, вам, возможно, придется установить более высокую `комиссию за приоритет`, но когда спрос меньше, вы можете платить меньше.

Например, Джордан хочет отправить Тэйлору 1 ETH. Трансфер ETH занимает в блоке 21 000 единиц газа, а базовая комиссия за газ — 10 gwei. Джордан добавляет чаевые в виде 2 gwei.

В итоге комиссия будет рассчитана таким образом:

`единиц использованного газа * (базовая комиссия + комиссия за приоритет)`

где `базовая комиссия` — это значение, устанавливаемое протоколом, а `комиссия за приоритет` — это значение, устанавливаемое пользователем в качестве чаевых валидатору.

например, `21 000 * (10 + 2) = 252 000 gwei` (0,000252 ETH).

Когда Джордан отправляет деньги, 1,000252 ETH будет списано со счета Джордана. Тэйлору будет начислено 1,0000 ETH. Валидатор получит чаевые в размере 0,000042 ETH. `Базовая комиссия` в размере 0,00021 ETH сжигается.

### Базовая комиссия {#base-fee}

У каждого блока есть базовая комиссия, которая действует как стартовая цена. Чтобы иметь право на включение в блок, предлагаемая цена за газ должна быть по крайней мере равна базовой комиссии. Базовая комиссия рассчитывается независимо от текущего блока и вместо этого определяется предыдущими блоками, что делает комиссии за транзакции более предсказуемыми для пользователей. Когда блок создается, эта **базовая комиссия «сжигается»**, выводя ее из обращения.

Базовая комиссия рассчитывается по формуле, которая сравнивает размер предыдущего блока (количество газа, использованного для всех транзакций) с целевым размером (половина лимита газа). Базовая комиссия будет увеличиваться или уменьшаться максимум на 12,5% за блок, если целевой размер блока больше или меньше целевого, соответственно. Этот экспоненциальный рост делает экономически нецелесообразным, чтобы размер блока оставался высоким на неопределенный срок.

| Номер блока | Включенный газ | Увеличение комиссии | Текущая базовая комиссия |
| ----------- | -------------: | ------------------: | -----------------------: |
| 1           |         18 млн |                  0% |                 100 gwei |
| 2           |         36 млн |                  0% |                 100 gwei |
| 3           |         36 млн |              12,5 % |               112,5 gwei |
| 4           |         36 млн |              12,5 % |               126,6 gwei |
| 5           |         36 млн |              12,5 % |               142,4 gwei |
| 6           |         36 млн |              12,5 % |               160,2 gwei |
| 7           |         36 млн |              12,5 % |               180,2 gwei |
| 8           |         36 млн |              12,5 % |               202,7 gwei |

В таблице выше показан пример с использованием лимита газа в 36 миллионов. Следуя этому примеру, чтобы создать транзакцию в блоке номер 9, кошелек с уверенностью сообщит пользователю, что **максимальная базовая комиссия**, которая будет добавлена в следующий блок, составляет `текущая базовая комиссия * 112,5%` или `202,7 gwei * 112,5% = 228,1 gwei`.

Также важно отметить, что сильные всплески серий полных блоков маловероятны из-за скорости, с которой базовая комиссия увеличивается перед полным блоком.

| Номер блока                                         |                                      Включенный газ | Увеличение комиссии |                            Текущая базовая комиссия |
| --------------------------------------------------- | --------------------------------------------------: | ------------------: | --------------------------------------------------: |
| 30                                                  |                                              36 млн |              12,5 % |                                         2705,6 gwei |
| ... | ... |              12,5 % | ... |
| 50                                                  |                                              36 млн |              12,5 % |                                        28531,3 gwei |
| ... | ... |              12,5 % | ... |
| 100                                                 |                                              36 млн |              12,5 % |                                     10302608,6 gwei |

### Комиссия за приоритет (чаевые) {#priority-fee}

Комиссия за приоритет (чаевые) стимулирует валидаторов максимизировать количество транзакций в блоке, ограниченное только лимитом газа в блоке. Без чаевых рациональный валидатор мог бы включать меньше транзакций — или даже ноль — без каких-либо прямых штрафов на уровне исполнения или уровне консенсуса, поскольку вознаграждения за стейкинг не зависят от количества транзакций в блоке. Кроме того, чаевые позволяют пользователям предлагать более высокую цену, чем другие, за приоритет в том же блоке, что фактически сигнализирует о срочности.

### Максимальная комиссия {#maxfee}

Чтобы исполнить транзакцию в сети, пользователи могут указать максимальный лимит, который они готовы заплатить за исполнение своей транзакции. Этот необязательный параметр известен как `maxFeePerGas`. Для исполнения транзакции максимальная комиссия должна превышать сумму базовой комиссии и чаевых. Отправителю транзакции возвращается разница между максимальной комиссией и совокупностью базовой комиссии и чаевых.

### Размер блока {#block-size}

Каждый блок имеет целевой размер, равный половине текущего лимита газа, но размер блоков будет увеличиваться или уменьшаться в соответствии со спросом в сети, пока не будет достигнут лимит блока (в 2 раза больше целевого размера блока). Протокол достигает равновесного среднего размера блока на целевом уровне с помощью процесса _tâtonnement_. Это означает, что если размер блока больше, чем целевой, протокол увеличит базовую комиссию для следующего блока. Аналогичным образом протокол уменьшит базовую комиссию, если размер блока меньше, чем целевой.

Сумма, на которую корректируется базовая комиссия, пропорциональна тому, насколько текущий размер блока отличается от целевого. Это линейный расчет от -12,5% для пустого блока, 0% при целевом размере и до +12,5% для блока, достигающего лимита газа. Лимит газа может со временем колебаться в зависимости от сигналов валидаторов, а также в результате обновлений сети. Вы можете [посмотреть изменения лимита газа с течением времени здесь](https://eth.blockscout.com/stats/averageGasLimit?interval=threeMonths).

[Подробнее о блоках](/developers/docs/blocks/)

### Расчет комиссий за газ на практике {#calculating-fees-in-practice}

Вы можете точно установить, сколько хотите заплатить за выполнение вашей транзакции. Однако многие поставщики кошельков автоматически устанавливают рекомендованную комиссию за транзакцию (базовая + рекомендованная приоритетная комиссия), чтобы упростить жизнь своим пользователям.

## Зачем нужны комиссии за газ? {#why-do-gas-fees-exist}

Если коротко, комиссия за газ помогает поддерживать безопасность сети Ethereum. Требуя плату за каждое вычисление, выполняемое в сети, мы не позволяем злоумышленникам рассылать по ней спам. Чтобы избежать случайных или умышленных бесконечных циклов и других вычислительных потерь в коде, каждой транзакции требуется установить ограничение на количество вычислительных шагов выполнения кода, которые она может использовать. Основной единицей вычислений является «газ».

Хотя транзакция включает в себя лимит, любой газ, не использованный в транзакции, возвращается пользователю (например, возвращается `максимальная комиссия - (базовая комиссия + чаевые)`).

![Схема, показывающая, как возвращается неиспользованный газ](../transactions/gas-tx.png)
_Схема адаптирована из [Ethereum EVM illustrated](https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf)_

## Что такое лимит газа? {#what-is-gas-limit}

Лимит газа — это максимальное количество газа, которое вы хотите израсходовать на транзакцию. Более сложные транзакции с участием [смарт-контрактов](/developers/docs/smart-contracts/) требуют больше вычислительной работы, поэтому для них требуется более высокий лимит газа, чем для простого платежа. Для стандартного перевода ETH предусматривается лимит в 21 000 единиц газа.

Например, если вы установите лимит газа в 50 000 для простого перевода ETH, EVM использует 21 000, а вам вернутся оставшиеся 29 000. Однако, если вы укажете слишком мало газа, например, лимит газа в 20 000 для простого перевода ETH, транзакция не пройдет этап проверки. Она будет отклонена до включения в блок, и газ не будет потреблен. С другой стороны, если во время выполнения в транзакции закончится газ (например, смарт-контракт израсходует весь газ на полпути), EVM отменит все изменения, но весь предоставленный газ все равно будет израсходован на выполненную работу.

## Почему комиссия за газ может быть такой высокой? {#why-can-gas-fees-get-so-high}

Высокая комиссия за газ связана с популярностью Ethereum. Если спрос слишком высок, пользователи могут предложить большие чаевые, чтобы попытаться обойти транзакции других пользователей в очереди. Чем выше чаевые, тем выше вероятность того, что ваша транзакция попадет в следующий блок. Кроме того, более сложные приложения со смарт-контрактами требуют проводить множество операций для выполнения своих функций, что делает их крупными потребителями газа.

## Инициативы по снижению затрат на газ {#initiatives-to-reduce-gas-costs}

[Обновления для масштабируемости](/roadmap/) Ethereum должны в конечном итоге решить некоторые проблемы с комиссией за газ, что, в свою очередь, позволит платформе обрабатывать тысячи транзакций в секунду и масштабироваться в глобальном масштабе.

Масштабирование на слое 2 — это основная инициатива, направленная на значительное снижение затрат газа, удобство работы пользователей и масштабируемость.

[Подробнее о масштабировании второго уровня](/developers/docs/scaling/#layer-2-scaling)

## Мониторинг комиссий за газ {#monitoring-gas-fees}

Если вы хотите отслеживать цены на газ, чтобы отправлять ETH дешевле, то можете использовать множество различных инструментов, включая следующее:

- [Etherscan](https://etherscan.io/gastracker) _Оценщик цены газа для транзакций_
- [Blockscout](https://eth.blockscout.com/gas-tracker) _Оценщик цены газа для транзакций с открытым исходным кодом_
- [ETH Gas Tracker](https://www.ethgastracker.com/) _Мониторинг и отслеживание цен на газ в Ethereum и L2 для снижения комиссий за транзакции и экономии денег_
- [Blocknative ETH Gas Estimator](https://chrome.google.com/webstore/detail/blocknative-eth-gas-estim/ablbagjepecncofimgjmdpnhnfjiecfm) _Расширение Chrome для оценки газа, поддерживающее как устаревшие транзакции типа 0, так и транзакции типа 2 EIP-1559._
- [Калькулятор комиссий за газ Cryptoneur](https://www.cryptoneur.xyz/gas-fees-calculator) _Рассчитывайте комиссии за газ в вашей местной валюте для различных типов транзакций в Mainnet, Arbitrum и Polygon._

## Связанные инструменты {#related-tools}

- [Газовая платформа Blocknative](https://www.blocknative.com/gas) _API для оценки газа на основе глобальной платформы данных мемпула Blocknative_
- [Gas Network](https://gas.network) Ончейн-оракулы газа. Поддержка более 35 сетей.

## Дополнительные материалы {#further-reading}

- [Разъяснение о газе в Ethereum](https://defiprime.com/gas)
- [Снижение потребления газа вашими смарт-контрактами](https://medium.com/coinmonks/8-ways-of-reducing-the-gas-consumption-of-your-smart-contracts-9a506b339c0a)
- [Стратегии оптимизации газа для разработчиков](https://www.alchemy.com/overviews/solidity-gas-optimization)
- [Документация по EIP-1559](https://eips.ethereum.org/EIPS/eip-1559).
- [Ресурсы по EIP-1559 от Тима Бейко](https://hackmd.io/@timbeiko/1559-resources)
- [EIP-1559: отделение механизмов от мемов](https://web.archive.org/web/20241126205908/https://research.2077.xyz/eip-1559-separating-mechanisms-from-memes)

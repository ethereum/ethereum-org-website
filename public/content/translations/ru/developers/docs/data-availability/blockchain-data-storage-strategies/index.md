---
title: Стратегии хранения данных в блокчейне
description: Существует несколько способов хранения данных с помощью блокчейна. В этой статье мы сравним различные стратегии, их стоимость и преимущества, а также требования к безопасному использованию.
lang: ru
---

Существует множество способов хранить информацию либо непосредственно на блокчейне, либо защитив её с помощью блокчейна:

- Блобы EIP-4844
- Calldata
- Офчейн с механизмами L1
- «Код» контракта
- Мероприятия
- Хранилище EVM

Выбор метода основывается на нескольких критериях:

- Источник информации. Информация в calldata не может поступать напрямую из самого блокчейна.
- Назначение информации. Calldata доступна только в транзакции, которая ее включает. События совершенно недоступны ончейн.
- Какой уровень сложности является приемлемым? Компьютеры, на которых запущен полный узел, могут выполнять больше обработки, чем легкий клиент в приложении, работающем в браузере.
- Необходимо ли обеспечивать легкий доступ к информации с каждого узла?
- Требования к безопасности.

## Требования к безопасности {#security-requirements}

В целом информационная безопасность состоит из трех атрибутов:

- _Конфиденциальность_: неавторизованные субъекты не могут читать информацию. Это важно во многих случаях, но не в этом. _В блокчейне не существует секретов_. Блокчейны работают, потому что любой может проверить переходы состояний, поэтому их невозможно использовать для прямого хранения секретов. Существуют способы хранения конфиденциальной информации в блокчейне, но все они используют какой-либо офф-чейн-компонент для хранения как минимум одного ключа.

- _Целостность_: информация корректна, она не может быть изменена неавторизованными субъектами или неавторизованными способами (например, передача [токенов ERC-20](https://eips.ethereum.org/EIPS/eip-20#events) без события `Transfer`). В блокчейне каждый узел проверяет каждое изменение состояния, что обеспечивает целостность.

- _Доступность_, информация доступна любому уполномоченному лицу. В блокчейне это обычно достигается за счет того, что информация доступна в каждом [полном узле](https://ethereum.org/developers/docs/nodes-and-clients#full-node).

Все представленные здесь решения обладают превосходной целостностью, поскольку хэши публикуются на L1. Однако у них разные гарантии доступности.

## Предварительные условия {#prerequisites}

Вы должны хорошо понимать [основы блокчейна](/developers/docs/intro-to-ethereum/). Эта страница также предполагает, что читатель знаком с [блоками](/developers/docs/blocks/), [транзакциями](/developers/docs/transactions/) и другими соответствующими темами.

## Блобы EIP-4844 {#eip-4844-blobs}

Начиная с [хардфорка Dencun](https://github.com/ethereum/consensus-specs/blob/dev/specs/deneb/beacon-chain.md), блокчейн Ethereum включает [EIP-4844](https://eips.ethereum.org/EIPS/eip-4844), который добавляет в Ethereum блобы данных с ограниченным сроком хранения (изначально около [18 дней](https://github.com/ethereum/consensus-specs/blob/dev/specs/deneb/p2p-interface.md#configuration)). Стоимость этих блобов рассчитывается отдельно от [газа за исполнение](/developers/docs/gas), хотя и с использованием похожего механизма. Это дешевый способ публикации временных данных.

Основной вариант использования блобов EIP-4844 — это публикация транзакций роллапами. [Оптимистические ролл-апы](/developers/docs/scaling/optimistic-rollups) должны публиковать транзакции в своих блокчейнах. Эти транзакции должны быть доступны любому в течение [периода оспаривания](https://docs.optimism.io/connect/resources/glossary#challenge-period), чтобы [валидаторы](https://docs.optimism.io/connect/resources/glossary#validator) могли исправить ошибку, если [секвенсор](https://docs.optimism.io/connect/resources/glossary#sequencer) ролл-апа публикует некорректный корень состояния.

Однако, как только период оспаривания пройдет и корень состояния будет финализирован, оставшаяся цель хранения этих транзакций заключается в воспроизведении текущего состояния сети. Это состояние также доступно на узлах сети и требует гораздо меньшей обработки. Поэтому информация о транзакциях все равно должна сохраняться в нескольких местах, таких как [обозреватели блоков](/developers/docs/data-and-analytics/block-explorers), но нет необходимости платить за тот уровень устойчивости к цензуре, который предоставляет Ethereum.

[Ролл-апы с нулевым разглашением](/developers/docs/scaling/zk-rollups/#data-availability) также публикуют данные своих транзакций, чтобы другие узлы могли воспроизводить существующее состояние и проверять доказательства достоверности, но это опять же краткосрочное требование.

На момент написания статьи публикация в EIP-4844 стоит один wei (10<sup>-18</sup> ETH) за байт, что ничтожно мало по сравнению со [стоимостью в 21 000 единиц газа за исполнение, которые требуются для любой транзакции, включая ту, что публикует блобы](https://eth.blockscout.com/tx/0xf6cfaf0431c73dd1d96369a5e6707d64f463ccf477a4131265397f1d81466929?tab=index). Вы можете увидеть текущую цену EIP-4844 на [blobscan.com](https://blobscan.com/blocks).

Вот адреса, по которым можно увидеть блобы, опубликованные некоторыми известными роллапами.

| Накопительные пакеты - это общий подход к масштабированию открытых контрактов, то есть контрактов, которые каждый может видеть и с которыми может взаимодействовать. При накоплении транзакции записываются в Ethereum (как calldata), но фактические вычисления и хранение контракта выполняются вне сети. Кто-то (валидатор) публикует в цепочке утверждение (также известное как блок Rollup) о том, что будет делать контракт - список действий, предпринятых контрактом, таких как произведенные платежи, и криптографический хеш его состояния после контракта. выполнил вызовы, которые уже были размещены в сети. Мы можем думать об утверждении как о «объединении» всех вызовов и их результатов в одну транзакцию в цепочке.Системы объединения отличаются тем, как они обеспечивают правильность утверждений | Адрес почтового ящика                                                                                                   |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| [Optimism](https://www.optimism.io/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | [`0xFF00000000000000000000000000000000000010`](https://blobscan.com/address/0xFF00000000000000000000000000000000000010) |
| [Arbitrum](https://arbitrum.io/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | [`0x1c479675ad559DC151F6Ec7ed3FbF8ceE79582B6`](https://blobscan.com/address/0x1c479675ad559DC151F6Ec7ed3FbF8ceE79582B6) |
| [Base](https://base.org/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | [`0xFF00000000000000000000000000000000008453`](https://blobscan.com/address/0xFF00000000000000000000000000000000008453) |

## Calldata {#calldata}

Calldata — это байты, отправляемые в составе транзакции. Она хранится как часть постоянной записи блокчейна в блоке, который включает эту транзакцию.

Это самый дешевый метод для постоянного размещения данных в блокчейне. Стоимость за байт составляет либо 4 единицы газа за исполнение (если байт нулевой), либо 16 единиц газа (любое другое значение). Если данные сжаты, что является стандартной практикой, то каждое значение байта равновероятно, поэтому средняя стоимость составляет примерно 15,95 единиц газа за байт.

На момент написания статьи цены составляют 12 gwei за газ и 2300 $ за ETH, что означает стоимость примерно 45 центов за килобайт. Поскольку это был самый дешевый метод до EIP-4844, роллапы использовали его для хранения информации о транзакциях, которая должна быть доступна для [оспаривания ошибок](https://docs.optimism.io/stack/protocol/overview#fault-proofs), но не требует прямого доступа ончейн.

Вот адреса, по которым можно увидеть транзакции, опубликованные некоторыми известными роллапами.

| Накопительные пакеты - это общий подход к масштабированию открытых контрактов, то есть контрактов, которые каждый может видеть и с которыми может взаимодействовать. При накоплении транзакции записываются в Ethereum (как calldata), но фактические вычисления и хранение контракта выполняются вне сети. Кто-то (валидатор) публикует в цепочке утверждение (также известное как блок Rollup) о том, что будет делать контракт - список действий, предпринятых контрактом, таких как произведенные платежи, и криптографический хеш его состояния после контракта. выполнил вызовы, которые уже были размещены в сети. Мы можем думать об утверждении как о «объединении» всех вызовов и их результатов в одну транзакцию в цепочке.Системы объединения отличаются тем, как они обеспечивают правильность утверждений | Адрес почтового ящика                                                                                                         |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| [Optimism](https://www.optimism.io/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | [`0xFF00000000000000000000000000000000000010`](https://eth.blockscout.com/address/0xFF00000000000000000000000000000000000010) |
| [Arbitrum](https://arbitrum.io/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | [`0x1c479675ad559DC151F6Ec7ed3FbF8ceE79582B6`](https://eth.blockscout.com/address/0x1c479675ad559DC151F6Ec7ed3FbF8ceE79582B6) |
| [Base](https://base.org/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | [`0xFF00000000000000000000000000000000008453`](https://eth.blockscout.com/address/0xFF00000000000000000000000000000000008453) |

## Офчейн с механизмами L1 {#offchain-with-l1-mechs}

В зависимости от ваших компромиссов в области безопасности, может быть приемлемо размещать информацию в другом месте и использовать механизм, который обеспечивает доступность данных при необходимости. Для этого необходимо выполнить два требования:

1. Опубликовать [хэш](https://en.wikipedia.org/wiki/Cryptographic_hash_function) данных в блокчейне, называемый _обязательством по входным данным_. Это может быть одно 32-байтное слово, поэтому это недорого. Пока доступно обязательство по входным данным, целостность гарантирована, потому что невозможно найти другие данные, которые бы хэшировались в то же значение. Поэтому если будут предоставлены неверные данные, это можно будет обнаружить.

2. Иметь механизм, обеспечивающий доступность. Например, в [Redstone](https://redstone.xyz/docs/what-is-redstone) любой узел может подать запрос на проверку доступности. Если секвенсор не ответит ончейн до установленного срока, обязательство по входным данным отбрасывается, и информация считается никогда не опубликованной.

Это приемлемо для оптимистического ролл-апа, потому что мы уже полагаемся на наличие хотя бы одного честного верификатора для корня состояния. Такой честный верификатор также убедится, что у него есть данные для обработки блоков, и отправит запрос на проверку доступности, если информация недоступна офф-чейн. Этот тип оптимистического ролл-апа называется [plasma](/developers/docs/scaling/plasma/).

## Код контракта {#contract-code}

Информация, которая должна быть записана только один раз, никогда не перезаписывается и должна быть доступна на блокчейне, может храниться в виде кода контракта. Это означает, что мы создаем «смарт-контракт» с данными, а затем используем [`EXTCODECOPY`](https://www.evm.codes/#3c?fork=shanghai) для чтения информации. Преимущество в том, что копирование кода относительно дешево.

Помимо стоимости расширения памяти, `EXTCODECOPY` стоит 2600 единиц газа за первый доступ к контракту (когда он «холодный») и 100 единиц газа за последующие копирования из того же контракта плюс 3 единицы газа за 32-байтовое слово. По сравнению с calldata, которая стоит 15,95 за байт, это дешевле, начиная примерно с 200 байт. Согласно [формуле стоимости расширения памяти](https://www.evm.codes/about#memoryexpansion), пока вам не нужно более 4 МБ памяти, стоимость расширения памяти меньше стоимости добавления calldata.

Конечно, это только стоимость _чтения_ данных. Создание контракта стоит примерно 32 000 единиц газа + 200 единиц газа/байт. Этот метод экономичен только тогда, когда одна и та же информация должна быть прочитана много раз в разных транзакциях.

Код контракта может быть бессмысленным, пока он не начинается с `0xEF`. Контракты, начинающиеся с `0xEF`, интерпретируются как [формат объектов Ethereum](https://notes.ethereum.org/@ipsilon/evm-object-format-overview), который имеет гораздо более строгие требования.

## События {#events}

[События](https://docs.alchemy.com/docs/solidity-events) генерируются смарт-контрактами и считываются офф-чейн программным обеспечением.
Их преимущество в том, что офф-чейн код может прослушивать события. Стоимость составляет [газ](https://www.evm.codes/#a0?fork=cancun): 375 плюс 8 единиц газа за байт данных. При цене 12 gwei за газ и 2300 $ за ETH это составляет один цент плюс 22 цента за килобайт.

## Хранилища {#storage}

Смарт-контракты имеют доступ к [постоянному хранилищу] (https://docs.alchemy.com/docs/smart-contract-storage-layout#what-is-storage-memory). Однако его использование очень дорого. Запись 32-байтного слова в ранее пустую ячейку хранилища может [стоить 22 100 единиц газа](https://www.evm.codes/#55?fork=cancun). При цене 12 gwei за газ и 2300 $ за ETH это составляет около 61 цента за операцию записи, или 19,5 $ за килобайт.

Это самая дорогая форма хранения в Ethereum.

## Сводка {#summary}

В этой таблице кратко изложены различные варианты, их преимущества и недостатки.

| Тип хранилища           | Источник данных     | Гарантия доступности                                                                                                                             | Доступность ончейн                                               | Дополнительные ограничения                                                 |
| ----------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------- | -------------------------------------------------------------------------- |
| Блобы EIP-4844          | Офф-чейн            | Гарантия Ethereum на [~18 дней](https://github.com/ethereum/consensus-specs/blob/dev/specs/deneb/p2p-interface.md#configuration) | Доступен только хэш                                              |                                                                            |
| Calldata                | Офф-чейн            | Гарантия Ethereum навсегда (часть блокчейна)                                                                                  | Доступно только при записи в контракт и в рамках этой транзакции |                                                                            |
| Офчейн с механизмами L1 | Офф-чейн            | Гарантия «одного честного верификатора» в течение периода оспаривания                                                                            | Только хэш                                                       | Гарантируется механизмом оспаривания, только в течение периода оспаривания |
| Код контракта           | Ончейн или офф-чейн | Гарантия Ethereum навсегда (часть блокчейна)                                                                                  | Да                                                               | Записывается на «случайный» адрес, не может начинаться с `0xEF`            |
| Мероприятия             | Ончейн              | Гарантия Ethereum навсегда (часть блокчейна)                                                                                  | Нет                                                              |                                                                            |
| Хранилище               | Ончейн              | Гарантия Ethereum навсегда (часть блокчейна и текущего состояния до перезаписи)                                               | Да                                                               |                                                                            |

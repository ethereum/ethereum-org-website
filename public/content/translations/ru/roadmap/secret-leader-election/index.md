---
title: "Выборы тайного лидера"
description: "Объяснение того, как выбор тайного лидера может помочь защитать валидаторы от атак"
lang: ru
summaryPoints:
  - IP-адрес предлагающих блоки можно узнать заранее, что делает их уязвимыми для атак.
  - Выбор тайного лидера скрывает данные валидаторов, поэтому их нельзя узнать заранее.
  - Развитие этой идеи — сделать выбор валидатора случайным в каждой ячейке.
---

# Выбор тайного лидера {#single-secret-leader-election}

В сегодняшнем механизме консенсуса, основанном на [доказательстве владения (proof-of-stake)](/developers/docs/consensus-mechanisms/pos), список следующих предлагающих блоки является общедоступным, и можно определить их IP-адреса. Это означает, что злоумышленники могут определить, какие валидаторы должны предложить блок, и нацелить на них атаку типа «отказ в обслуживании» (DOS-атаку), которая не позволяет им предложить свой блок вовремя.

Это может дать злоумышленнику возможность получить прибыль. Например, предлагающий блок, выбранный для слота `n+1`, может провести DOS-атаку на предлагающего в слоте `n`, чтобы тот упустил возможность предложить блок. Это позволило бы предлагающему блок, совершающему атаку, извлечь MEV обоих слотов или захватить все транзакции, которые должны были быть разделены на два блока, и вместо этого включить их все в один, получая все связанные комиссии. Скорее всего, это больше влияет на домашних валидаторов, чем на опытных институциональных, которые могут использовать более передовые методы для защиты от DOS-атак и, таким образом, стать централизирующей силой.

Существуют несколько решений этой проблемы. Одним из них является [технология распределенного валидатора (Distributed Validator Technology)](https://github.com/ethereum/distributed-validator-specs), цель которой — распределить различные задачи, связанные с работой валидатора, по нескольким машинам с избыточностью, чтобы злоумышленнику было гораздо сложнее предотвратить предложение блока в определенном слоте. Однако самым надежным решением является **выбор одного тайного лидера (SSLE)**.

## Выбор одного тайного лидера {#secret-leader-election}

Для SSLE используется умная криптография для обеспечения того, чтобы только выбранный валидатор знал, что он был выбран. Это работает путем представления каждым валидатором обязательства к секрету, который они все разделяют. Обязательства перетасовываются и изменяются таким образом, чтобы никто не мог сопоставить обязательства с валидаторами, но каждый валидатор знал, какое обязательство ему принадлежит. Затем случайно выбирается одно обязательство. Если валидатор обнаруживает, что его обязательство было выбрано, он знает, что сейчас его очередь предложить блок.

Ведущая реализация этой идеи называется [Whisk](https://ethresear.ch/t/whisk-a-practical-shuffle-based-ssle-protocol-for-ethereum/11763). Она работает следующим образом:

1. Валидаторы подчиняются общему секрету. Схема обязательств разработана таким образом, что она может быть привязана к идентификатору валидатора, а также рандомизирована, чтобы никакая третья сторона не могла связать конкретное обязательство с конкретным валидатором, даже используя обратную инженерию.
2. В начале эпохи выбирается случайный набор валидаторов для выборки обязательств из 16 384 валидаторов с использованием RANDAO.
3. Для следующих 8182 ячеек (1 день) валидаторы перемешивают и рандомизируют подмножество обязательств, используя их собственную энтропию.
4. После завершения перетасовки RANDAO используется для создания упорядоченного списка обязательств. Этот список проецируется на ячейки Ethereum.
5. Валидаторы видят, что их обязательства привязаны к определенной ячейке. Когда наступает время этой ячейки, они предлагают блок.
6. Эти шаги повторяются, чтобы распределение обязательств по ячейкам всегда значительно опережало нынешнюю ячейку.

Это мешает злоумышленникам заранее узнать, какой конкретный валидатор предложит следующий блок, предотвращая возможность DOS-атак.

## Выбор нескольких тайных лидеров (SnSLE) {#secret-non-single-leader-election}

Существует также отдельное предложение, направленное на создание сценария, при котором у каждого валидатора есть случайный шанс предложить блок в каждом слоте, подобно тому как предложение блока определялось при доказательстве работы (proof-of-work), что известно как **выбор нескольких тайных лидеров (SnSLE)**. Один из простых способов реализовать это — использовать функцию RANDAO, применяемую для случайного выбора валидаторов в действующем сейчас протоколе. Идея с RANDAO заключается в том, что достаточно случайное число генерируется путем смешивания хэшей, представленных многими независимыми валидаторами. При SnSLE эти хэши можно использовать для выбора следующего предлагающего блок, например выбрав хэш с самым низким значением. Диапазон допустимых хэшей может быть ограничен для настройки вероятности выбора отдельных валидаторов в каждом слоте. Утверждая, что хэш должен быть меньше `2^256 * 5 / N`, где `N` = количество активных валидаторов, шанс любого отдельного валидатора быть выбранным в каждом слоте будет равен `5/N`. В этом примере есть вероятность 99,3 %, что по крайней мере один предлагающий сгенерирует действительный хэш в каждой ячейке.

## Текущий прогресс {#current-progress}

SSLE и SnSLE находятся в стадии исследования. Окончательных спецификаций ни для одной из этих идей пока нет. SSLE и SnSLE — конкурирующие предложения, которые не могут быть реализованы вместе. Перед внедрением они нуждаются в дополнительных исследованиях и разработках, прототипировании и реализации в общедоступных тестовых сетях.

## Дополнительные материалы {#further-reading}

- [SnSLE](https://ethresear.ch/t/secret-non-single-leader-election/11789)

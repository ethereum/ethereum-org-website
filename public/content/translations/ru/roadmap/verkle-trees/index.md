---
title: Деревья Веркла
description: Высокоуровневое описание деревьев Веркла и того, как они будут использоваться для обновления Ethereum
lang: ru
summaryPoints:
  - Узнайте, что такое деревья Веркла
  - Прочитайте, почему деревья Веркла являются полезным обновлением для Ethereum
---

# Деревья Веркла {#verkle-trees}

Деревья Веркла («векторное обязательство» + «деревья Меркла») — это структура данных, которая может быть использована для обновления узлов Ethereum, чтобы они могли прекратить хранение больших объемов данных о состоянии, не теряя возможность валидировать блоки.

## Клиенты не использующие состояние {#statelessness}

Деревья Веркла являются важным шагом на пути к клиентам без состояния. Клиенты без состояния — это клиенты, которым не нужно хранить всю базу данных о состоянии Ethereum для проверки входящих блоков. Вместо использования собственной локальной копии состояния Ethereum для проверки блоков клиенты без состояния используют «свидетельство» данных состояния, которое приходит вместе с блоком. Свидетельство — это коллекция отдельных частей данных о состоянии, необходимых для выполнения определенного набора транзакций, и криптографическое доказательство того, что свидетельство действительно является частью полных данных. Свидетельство используется _вместо_ базы данных состояния. Для этого свидетельства должны быть очень маленькими, чтобы их можно было безопасно и вовремя транслировать по сети, а проверяющие могли обработать их в течение слота в 12 секунд. Нынешняя структура данных о состоянии не подходит, поскольку свидетельства слишком велики. Деревья Веркла решают эту проблему, допуская маленькие свидетельства и устраняя один из главных барьеров на пути к клиентам без состояния.

<ExpandableCard title="Зачем нам клиенты без состояния?" eventCategory="/roadmap/verkle-trees" eventName="clicked why do we want stateless clients?">

Клиенты Ethereum в настоящее время используют структуру данных хэш-дерево Меркла вида Patricia для хранения данных о состоянии. Информация об отдельных аккаунтах хранится в виде «листьев» на дереве хэшей, а пары «листьев» постоянно хэшируются до тех пор, пока не останется только один хэш. Этот последний хэш называют «корнем». Для проверки блоков клиенты Ethereum выполняют все транзакции в блоке и обновляют свои локальные деревья состояния. Блок считается действительным, если корень локального дерева идентичен тому, который предоставил предлагающий блок, поскольку любые различия в вычислениях, выполняемых предлагающим и узлом валидатора, приведут к тому, что корневой хэш будет совершенно другим. Проблема здесь в том, что для проверки блокчейна нужно, чтобы каждый клиент хранил все дерево хэшей для головного блока и для нескольких исторических блоков (в Geth стоит по умолчанию удержание данных о состоянии 128 блоков за головным блоком). Это требует, чтобы клиенты имели доступ к большому дисковому пространству, что является барьером для работы полных узлов на дешевом и маломощном оборудовании. Решением этого является обновление дерева состояния до более эффективной структуры (дерева Веркла), которая может быть обобщена с помощью небольшого «свидетельства» данных, используемого вместо полных данных о состоянии. Переформатирование данных о состоянии в дерево Веркла является отправной точкой для перехода к клиентам без состояния.

</ExpandableCard>

## Что такое свидетельство и зачем оно нам нужно? {#what-is-a-witness}

Проверка блока означает повторное выполнение транзакций, содержащихся в блоке, применение изменений к дереву состояния Ethereum и вычисление нового корневого хэша. Проверенный блок — это блок, чей вычисленный корневой хэш состояния совпадает с тем, который предоставлен вместе с блоком (поскольку это означает, что тот, кто предложил блок, действительно выполнил вычисления, о которых он заявил). В сегодняшних клиентах Ethereum обновление состояния требует доступа ко всему дереву состояния — большой структуре данных, которые должны храниться локально. Свидетельство содержит только фрагменты данных о состоянии, которые необходимы для выполнения транзакций в блоке. Валидатор сможет использовать только эти фрагменты, чтобы удостовериться, что предложивший блок выполнил транзакции и обновил состояние правильно. Однако это означает, что свидетельство необходимо передавать между одноранговыми пользователями по сети Ethereum достаточно быстро, чтобы оно было принято и обработано каждым узлом безопасно в 12-секундном слоте. Если свидетельство слишком велико, некоторым узлам может потребоваться слишком много времени, чтобы загрузить его, не отставая от цепи. Это централизующая сила, потому что это означает, что только узлы с быстрым интернет-соединением смогут участвовать в проверке блоков. С деревьями Веркла нет необходимости хранить состояние на жестком диске. _Все_, что нужно для проверки блока, находится в самом блоке. К сожалению, свидетельства, которые могут быть получены с помощью деревьев Меркла, слишком велики, чтобы поддерживать клиенты без состояния.

## Почему деревья Веркла дают нам свидетельства меньшего размера? {#why-do-verkle-trees-enable-smaller-witnesses}

Структура дерева Меркла делает размер свидетельства очень большим — слишком большим, чтобы безопасно передавать его между одноранговыми пользователями в 12-секундном слоте. Причина в том, что свидетельство — это путь, соединяющий данные, которые хранятся в листьях, с корневым хэшем. Для проверки данных необходимо иметь не только все промежуточные хэши, соединяющие каждый лист с корнем, но и все «близкие» узлы. Каждый узел в доказательстве имеет еще один близкий, с которым он хэшируется, чтобы создать следующий хэш на дереве. Это очень большой объем данных. Деревья Веркла уменьшают размер свидетельства, сокращая расстояние между листьями дерева и его корнем, а также устраняя необходимость предоставления близких узлов для проверки корневого хэша. Еще большая экономия пространства будет достигнута за счет использования мощной схемы полиномиального обязательства вместо векторного обязательства в стиле хэша. Полиномиальное (многочленное) обязательство позволяет свидетельству иметь фиксированный размер независимо от количества листьев, которое оно подтверждает.

При схеме обязательств с использованием многочленов свидетельства получают приемлемый размер, который можно легко передавать в одноранговой сети. Это позволяет клиентам проверять изменение состояния в каждом блоке, используя минимальное количество данных.

<ExpandableCard title="Насколько в реальности деревья Веркла могут уменьшить размер свидетельства?" eventCategory="/roadmap/verkle-trees" eventName="clicked exactly how much can Verkle trees reduce witness size?">

Размер свидетельства зависит от количества листьев, которые оно включает. Если принять, что свидетельство покрывает 1000 листьев, свидетельство для дерева Меркла будет весить около 3,5 МБ (предполагая 7 уровней дерева). Свидетельство для тех же данных в дереве Веркла (предполагая 4 уровня дерева) будет весить около 150 КБ — **примерно в 23 раза меньше**. Такое сокращение размера свидетельства позволит клиентам без состояния быть приемлемо малыми. Размер полиномиальных свидетельств составляет от 0,128  до 1 КБ (в зависимости от конкретного используемого полиномиального обязательства).

</ExpandableCard>

## Какова структура дерева Веркла? {#what-is-the-structure-of-a-verkle-tree}

Деревья Веркла — это пары `(key,value)`, в которых ключи состоят из 32-байтовых элементов, включающих 31-байтовый _stem_ и 1-байтовый _suffix_. Эти ключи организованы в узлы _расширения_ и _внутренние_ узлы. Узлы расширения представляют собой единую основу с 256 потомками и разными суффиксами. Внутренние узлы тоже имеют 256 потомков, но они могут в то же время являться другими узлами расширения. Основное различие между структурами дерева Веркла и дерева Меркла заключается в том, что дерево Веркла гораздо более плоское. Это значит, что существует меньше промежуточных узлов, связывающих лист с корнем, и, следовательно, меньше данных, необходимых для создания доказательства.

![](./verkle.png)

[Подробнее о структуре деревьев Веркла](https://blog.ethereum.org/2021/12/02/verkle-tree-structure)

## Текущий прогресс {#current-progress}

Тестовые сети деревьев Веркла уже запущены, но все еще есть существенные обновления для клиентов, которые необходимы для поддержки деревьев Веркла. Вы можете помочь ускорить прогресс, развертывая смарт-контракты или клиенты в тестовых сетях.

[Узнайте о тестовой сети Verkle Gen Devnet 2](https://verkle-gen-devnet-2.ethpandaops.io/)

[Посмотрите объяснение Гийома Балле о тестовой сети Condrieu Verkle](https://www.youtube.com/watch?v=cPLHFBeC0Vg) (обратите внимание: тестовая сеть Condrieu была основана на доказательстве выполнения работы, она заменена на тестовую сеть Verkle Gen Devnet 2).

## Дополнительная литература {#further-reading}

- [Деревья Веркла для клиентов без фиксации состояния](https://verkle.info/)
- [Данкрад Фейст объясняет деревья Веркла на PEEPanEIP](https://www.youtube.com/watch?v=RGJOQHzg3UQ)
- [Гийом Балле объясняет деревья Веркла на ETHGlobal](https://www.youtube.com/watch?v=f7bEtX3Z57o)
- [«Как деревья Меркла делают Ethereum эффективным и готовым к работе» — Гийом Балле, Devcon 6](https://www.youtube.com/watch?v=Q7rStTKwuYs)
- [Пайпер Мерриам о клиентах без состояния на ETHDenver 2020](https://www.youtube.com/watch?v=0yiZJNciIJ4)
- [Данкрад Фиест объясняет, что такое деревья Веркла и клиенты без фиксации состояния, в подкасте Zero Knowledge](https://zeroknowledge.fm/episode-202-stateless-ethereum-verkle-tries-with-dankrad-feist/)
- [Виталик Бутерин о деревьях Веркла](https://vitalik.eth.limo/general/2021/06/18/verkle.html)
- [Данкрад Фейст о деревьях Веркла](https://dankradfeist.de/ethereum/2021/06/18/verkle-trie-for-eth1.html)
- [Документация EIP деревьев Веркла](https://notes.ethereum.org/@vbuterin/verkle_tree_eip#Illustration)

---
title: 帐户抽象
description: 关于以太坊简化用户帐户和增强用户帐户安全性的计划的概述
lang: zh
summaryPoints:
  - 帐户抽象大大简化了构建智能合约钱包的过程
  - 智能合约钱包大大简化了管理以太坊帐户访问的过程
  - 丢失和泄露的密钥可以通过多重备份进行找回
---

# 帐户抽象 {#account-abstraction}

用户通过**[外部帐户 (EOA)](/glossary/#eoa)** 与以太坊进行交互。 这是当前开始交易或执行智能合约的唯一方式， 这限制了用户与以太坊的交互。 例如，这导致很难进行批量交易，并且要求用户一直让以太币帐户中有余额以支付燃料费。

帐户抽象是解决这些问题的一种方式，可以让用户灵活地设置自己的帐户，以提高安全性和改善用户体验。 要完成帐户抽象，可以[升级外部帐户](https://eips.ethereum.org/EIPS/eip-3074)，使它们能被智能合约控制，或者[升级智能合约](https://eips.ethereum.org/EIPS/eip-2938)，使它们能够发起交易。 这两种方案都需要对以太坊协议进行更改。 还有第三种途径，即添加[第二个独立的交易系统](https://eips.ethereum.org/EIPS/eip-4337)，与现有协议并行运行。 无论采取哪种路径，结果都是通过智能合约钱包访问以太坊，要么作为现有协议的一部分得到本地支持，要么通过附加的交易网络完成。

智能合约钱包可以为用户带来许多好处，包括：

- 灵活定义自己的安全规则
- 丢失密钥后找回帐户
- 在信赖的设备或个人之间共享帐户安全性
- 支付他人的燃料费用，或让他人为你支付燃料费用
- 批量交易（例如，一次性批准并执行兑换）
- 增加去中心化应用程序和钱包开发者创新用户体验的机会

由于目前只有外部帐户 ([EOA](/glossary/#eoa)) 可以发起交易，所以这些好处还没有得到本地支持。 外部帐户采用简单的公钥-私钥对。 它们的工作原理如下：

- 如果你拥有私钥，可以在以太坊虚拟机 (EVM) 的规则范围内做_任何_事情。
- 如果你没有私钥，将无法进行_任何操作_。

如果你丢失了密钥则无法找回，而窃取者可以使用窃取的密钥立即获得帐户中的所有资金。

智能合约钱包是解决这些问题的方法，但是目前它们很难编程，因为最终它们实现的任何逻辑都必须被转换为一系列外部帐户交易，才能被以太坊处理。 帐户抽象可以让智能合约自行发起交易，因此用户希望实现的任何逻辑都可以编码到智能合约钱包本身，并在以太坊上执行。

最后，帐户抽象可以改善对智能合约钱包的支持，使其更易于构建且更安全地使用。 最终，通过帐户抽象化，用户可以享受以太坊的所有好处，而无需了解或关心底层技术。

## 超越助记词 {#beyond-seed-phrases}

目前，帐户是通过私钥保护的，而私钥是通过助记词计算出来的。 获得助记词的任何人都可以轻松掌握保护帐户的私钥，并获得其保护的所有资产。 如果私钥和助记词丢失，它们将永远无法找回，并且它们所控制的资产将永久冻结。 即使对于专业用户来说，保护这些助记词也很困难，而助记词钓鱼是用户遭受诈骗的最常见方式之一。

帐户抽象通过使用智能合约来持有资产和授权交易，解决了这个问题。 然后，这些智能合约可以用自定义逻辑装饰，以尽可能提高安全性，并根据用户的需求进行定制。 最终，你仍是使用私钥来控制帐户访问，但是有了安全措施，帐户就更易于管理且更安全。

例如，可以将备用密钥添加到钱包中，这样如果你丢失或意外泄露了主要密钥，可以通过备用密钥的授权将其替换为新的安全密钥。 你可以通过不同方式保护这些密钥，或者将它们分散到不同的受信任守护者。 这大大提高了窃取者完全控制你的资金的难度。 同样，你可以在钱包中添加规则以减轻主要密钥泄露的影响。例如，你可以允许低价值交易由单个签名验证，而高价值交易则需要由多个经过身份验证的签名者批准。 智能合约钱包还可以通过其他方式防止你遭到窃取。例如，你可以使用白名单来阻止其他所有交易，除了发送到可信地址或经过多个预先批准的密钥验证的交易。

### 可以内置到智能合约钱包中的安全逻辑的示例：

- **多重签名授权**：你可以在多个受信任的人或设备之间共享授权凭证。 然后，可以对合约进行配置，以便超过预设值的交易需要获得一定比例（例如 3/5）的受信任方的授权。 例如，高价值的交易可能需要在移动设备和硬件钱包上都获得批准，或者需要分散在受信任家庭成员的帐户的签名。
- **帐户冻结**：如果设备丢失或被入侵，可以从另一个经过授权的设备上锁定帐户，以保护用户的资产安全。
- **帐户找回**：丢失设备或忘记密码了？ 在目前的模式下，这意味着你的资产可能被永远冻结。 通过使用智能合约钱包，你可以设置帐户白名单来授权新设备并重置访问权限。
- **设置交易限制**：指定帐户一天/一周/一月可以转移的每日价值阈值。 这意味着，即使攻击者成功获得了你的帐户的访问权限，他们也无法一次性将所有资金转移走，而你有机会冻结帐户并重新设置访问权限。
- **创建白名单**：仅允许与你确认安全的地址进行交易。 这意味着_即使_你的私钥被盗，攻击者也只能将资金发送到白名单上的目标帐户。 这些白名单需要多个签名才能更改。因此，除非攻击者能够获得你的多个备份密钥，否则无法将自己的地址添加到名单中。

## 改善用户体验 {#better-user-experience}

帐户抽象可以改善**整体用户体验**和**安全性**，因为它在协议层面上为智能合约钱包增加了支持。 最重要的原因是它将为智能合约、钱包和应用的开发者提供更大的创新自由度，使他们能够以我们目前还无法预料到的方式改进用户体验。 通过帐户抽象，我们将迎来一些明显改进，其中包括捆绑交易以提高速度和效率。 例如，简单的兑换应该是一键操作的，但在当前情况下，执行兑换之前需要签署多个交易来批准每个代币的支出。 帐户抽象通过允许交易捆绑消除了这一问题。 此外，捆绑的交易可以精确批准每个交易所需的适当代币价值，然后在交易完成后撤销批准，提供额外的安全性。

通过帐户抽象，燃料管理也得到了很大改进。 不仅应用程序可以支付用户的燃料费，而且可以使用以太币以外的代币支付燃料费，从而使用户无需为提供交易资金而保持帐户中有以太币余额。 可以这样做，在合约内使用用户的代币兑换以太币，然后使用以太币支付燃料费。

<ExpandableCard title="帐户抽象在燃料方面有何用处？" eventCategory="/roadmap/account-abstraction" eventName="clicked how can account abstraction help with gas?">

燃料管理是以太坊用户主要面临的问题之一，主要是因为以太币是唯一可用于支付交易费用的资产。 假设你的钱包内有 USDC 余额但没有以太币余额。 由于你无法支付燃料费用，所以无法转移或交换这些 USDC 代币。 你也无法将 USDC 交换成以太币，因为这个操作本身也需要支付燃料费用。 要解决这个问题，你需要从交易所或其他地址向你的帐户发送更多以太币。 通过智能合约钱包，你可以轻松使用 USDC 支付燃料费用，从而解放你的帐户。 你不再需要在所有帐户中保持以太币余额了。

帐户抽象还可以让去中心化应用程序的开发者以创造性的方式进行燃料管理。 例如，你可以考虑与你最喜爱的去中心化交易所达成协议，每月支付固定费用以获得无限次交易的权限。 去中心化应用程序可能会作为你使用其平台的奖励或入门优惠，为你支付所有燃料费用。 当智能合约钱包在协议层面得到支持时，开发者在燃料管理方面进行创新将更加容易。

</ExpandableCard>

受信任会话同样也有可能改变用户体验，尤其是对于游戏等可能需要在短时间内批准大量小额交易的应用程序而言。 单独批准每笔交易将破坏游戏体验，但永久批准则存在安全风险。 智能合约钱包可以在固定时间内批准不超过特定金额或仅与特定地址进行的特定交易。

此外，帐户抽象会给购买方式带来变化，这也是一个有趣的方面。 目前，每笔交易都需要通过预先充入充足的适当代币的钱包批准和执行。 进行帐户抽象后，用户的体验会更像我们熟悉的在线购物体验，用户可以将商品添加到“购物车”中，然后一次性点击购买，所有必需的逻辑都由智能合约处理，而不是由用户处理。

这只是帐户抽象可以提升用户体验的一些例子，还有许多我们尚未想象到的情况。 帐户抽象让开发者摆脱了当前以太坊外部帐户的限制，使他们能够在不放弃自我保管的情况下将 Web2 的良好特性引入 Web3，并创造性带来创新用户体验。

## 帐户抽象将如何实施？ {#how-will-aa-be-implemented}

智能合约钱包目前已存在，但由于以太坊虚拟机不支持，所以实现起来会有一些挑战。 相反，它们采用的方法是将相对复杂的代码封装在标准的以太坊交易中。 以太坊可以改变这一点，允许智能合约发起交易，在以太坊智能合约中处理必要逻辑，而不是链下处理。 将逻辑放入智能合约还增加了以太坊的去中心化程度，因为不再需要由钱包开发者运行的"中继者"将用户签名的消息转换为常规的以太坊交易。

<ExpandableCard title="EIP-2771：使用元交易进行帐户抽象" eventCategory="/roadmap/account-abstract" eventName="clicked EIP-2771: account abstraction using meta-transactions">

EIP-2771 引入了元交易的概念，允许第三方为用户支付燃料费用，而无需对以太坊协议进行更改。 这个想法是将用户签名的交易发送到一个名为“转发者”的合约中。 转发者是一个受信任的实体，在将交易发送到燃料中继器之前验证交易的有效性。 这是链下完成的，无需支付燃料费用。 燃料中继器将交易传递到“接收者”合约，支付所需的燃料费用，使交易能够在以太坊上执行。 如果“接收者”知道并信任“转发者”，则交易将被执行。 该模型使得开发者能够为用户轻松实现无需支付燃料费用的交易。

</ExpandableCard>

<ExpandableCard title="EIP-4337：不改变以太坊协议进行帐户抽象" eventCategory="/roadmap/account-abstract" eventName="clicked EIP-4337: account abstraction without changing the Ethereum protocol">

EIP-4337 是以去中心化方式使智能合约钱包获得本地支持的第一步，<em>无需对以太坊协议进行更改</em>。 它并未修改共识层以支持智能合约钱包，而是在正常的交易传播协议中单独添加了一个新系统。 这个更高层次的系统是围绕一个叫做 <code>UserOperation</code> 的新对象构建，它将用户的操作与相关的签名打包在一起。 这些 <code>UserOperation</code> 对象随后被广播到一个专用的内存池中，验证者在那里可以将它们收集到一个"捆绑交易"中。 捆绑交易代表了很多一系列单独的 <code>UserOperations</code>，并且可以像普通交易那样被添加到以太坊区块中。验证者会使用类似的最大化费用选择模型来选择捆绑交易。

在 EIP-4337 下，钱包的工作方式也会改变。 它不会让每个钱包重新实现常见但复杂的安全逻辑，而是会将这些功能外包给一个名为“入口点”的全局钱包合约。 该合约将处理支付费用和执行以太坊虚拟机代码等操作，以便钱包开发者可以专注于提供卓越的用户体验。

<strong>注意</strong> EIP 4337 入口点合约于 2023 年 3 月 1 日部署到以太坊主网上。 你可以在 <a href="https://etherscan.io/address/0x0576a174D229E3cFA37253523E645A78A0C91B57">Etherscan</a> 上查看该合约。

</ExpandableCard>

<ExpandableCard title="EIP-2938：改变以太坊协议以支持帐户抽象" eventCategory="/roadmap/account-abstract" eventName="clicked EIP-2938: changing the Ethereum protocol to support account abstraction">

<a href="https://eips.ethereum.org/EIPS/eip-2938">EIP-2938</a> 旨在通过引入新的交易类型 <code>AA_TX_TYPE</code> 来更新以太坊协议，该交易类型包括三个字段：<code>nonce</code>、<code>target</code> 和 <code>data</code>，其中 <code>nonce</code> 是交易计数器，<code>target</code> 是入口点合约地址，<code>data</code> 是以太坊虚拟机字节码。 为了执行这些交易，需要向以太坊虚拟机添加两条新指令（也称为操作码）：<code>NONCE</code> 和 <code>PAYGAS</code>。 <code>NONCE</code> 操作码用于跟踪交易序列，而 <code>PAYGAS</code> 操作码用于计算并从合约余额中提取执行交易所需的燃料费用。 这些新功能使得以太坊能够为智能合约钱包提供本地支持，因为必要的基础设施已经内置在以太坊的协议中。

请注意，EIP-2938 目前尚未激活。 目前社区更倾向于 EIP-4337，因为它不需要对协议进行更改。

</ExpandableCard>

<ExpandableCard title="EIP-3074：升级外部帐户以实现帐户抽象" eventCategory="/roadmap/account-abstract" eventName="clicked EIP-3074: upgrading externally-owned accounts for account abstraction">

<a href="https://eips.ethereum.org/EIPS/eip-3074">EIP-3074</a> 旨在更新以太坊的外部帐户，允许其将控制权委托给智能合约。 这意味着智能合约逻辑可以批准源自外部帐户的交易。 这可以实现一些功能，如燃料赞助和批量交易。 要使其生效，需要向以太坊虚拟机添加两个新的操作码：<code>AUTH</code> 和 <code>AUTHCALL</code>。 通过 EIP-3074，<em>不需要合约</em>就可以获得智能合约钱包的好处，取而代之的是一种特定类型的无状态、去信任、不可升级的合约（被称为“调用者”），用于处理交易。

请注意，EIP-3074 目前尚未激活。 目前社区更倾向于 EIP-4337，因为它不需要对协议进行更改。

</ExpandableCard>

## 当前进展 {#current-progress}

智能合约钱包已经推出，但需要进行更多升级以使其尽可能去中心化和无需许可。 EIP-4337 是一个成熟的提案，不需要对以太坊的协议进行任何更改，因此可能可以迅速实施。 然而，当前并没有积极开发用于更改以太坊协议的升级，因此这些更改可能需要更长时间才能上线， 也有可能通过 EIP-4337 充分实现帐户抽象，不再需要更改协议。

## 延伸阅读 {#further-reading}

- [erc4337.io](https://www.erc4337.io/)
- [帐户抽象面板探讨 — Devcon Bogota](https://www.youtube.com/watch?app=desktop&v=WsZBymiyT-8)
- ["为什么帐户抽象对于去中心化应用程序而言是一场革命性的变革" — Devcon Bogota](https://www.youtube.com/watch?v=OwppworJGzs)
- [“帐户抽象 ELI5” — Devcon Bogota](https://www.youtube.com/watch?v=QuYZWJj65AY)
- [Vitalik“帐户抽象之路”说明](https://notes.ethereum.org/@vbuterin/account_abstraction_roadmap#Transaction-inclusion-lists)
- [Vitalik 关于社交恢复钱包的博文](https://vitalik.eth.limo/general/2021/01/11/recovery.html)
- [EIP-2938 说明](https://hackmd.io/@SamWilsn/ryhxoGp4D#What-is-EIP-2938)
- [EIP-2938 文件](https://eips.ethereum.org/EIPS/eip-2938)
- [EIP-4337 说明](https://medium.com/infinitism/erc-4337-account-abstraction-without-ethereum-protocol-changes-d75c9d94dc4a)
- [EIP-4337 文件](https://eips.ethereum.org/EIPS/eip-4337)
- [EIP-2771 文件](https://eips.ethereum.org/EIPS/eip-2771)
- [“帐户抽象基础知识”-- 什么是帐户抽象（第一部分）](https://www.alchemy.com/blog/account-abstraction)

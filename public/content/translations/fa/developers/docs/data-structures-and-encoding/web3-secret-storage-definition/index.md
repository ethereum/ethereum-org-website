---
title: تعریف ذخیره سازی مخفی Web3
description: یک تعریف رسمی برای حافظه پنهان Web3
lang: fa
sidebarDepth: 2
---

برای اینکه اپلیکیشن شما بر روی اتریوم کار کند، میتوانید از آبجکت‌ Web3 که توسط کتابخانه web3.js فراهم شده استفاده کنید. در پس زمینه، این کتابخانه از طریق فراخوانی RPC به یک نود محلی متصل میشود. این کتابخانه با هر نود اتریومی که لایه RPC داشته باشد کار میکند.

`web3` شامل آبجکت `eth` می‌باشد-web3.eth

```js
var fs = require("fs")
var recognizer = require("ethereum-keyfile-recognizer")

fs.readFile("keyfile.json", (err, data) => {
  var json = JSON.parse(data)
  var result = recognizer(json)
})

/** result
 *               [ 'web3', 3 ]   web3 (v3) keyfile
 *  [ 'ethersale', undefined ]   Ethersale keyfile
 *                        null     invalid keyfile
 */
```

این مستندات **ورژن سوم** تعریف حافظه پنهان Web3 می‌باشند.

## تعریف {#definition}

رمزگذاری و رمزگشایی فایل نسبت به ورژن اول تا حد زیادی تغییری نکرده‌ است، جز این که الگوریتم رمزنگاری دیگر روی AES-128-CBC تثبیت نشده است (AES-128-CTR اکنون لازمه حداقل است). بیشتر معانی و الگوریتم‌ها همانند ورژن اول هستند، به جز `mac`، که به عنوان SHA3 (keccak-256) از ترکیب دومین 16 بایت از چپ از کلید مشتق‌شده به همراه کل `ciphertext` تعریف می‌شود.

فایل‌های کلید مخفی مستقیما در `~/.web3/keystore` (برای سیستم‌هایی مانند Unix) و `~/AppData/Web3/keystore` (برای ویندوز) ذخیره می‌شوند. ممکن است هر چیزی نام گذاری شوند، اما بهترین نام گذاری میتواند `<uuid>.json` باشد که `<uuid>` یک UUIDی 128 بیتی است که به کلید مخفی داده میشود (یک پروکسی حفظ حریم خصوصی برای آدرس کلیدهای مخفی).

همه این فایل‌ها یک پسورد مربوط به خودشان را دارند. برای استخراج کلید مخفی یک فایل `.json`، ابتدا باید کلید رمزگذاری فایل را استخراج کرد. در واقع این کار از طریق دریافت پسورد فایل‌ها و دادن آن پسورد به تابع استخراج همانطور که توسط کلید `kdf` تعریف شده‌است، انجام میشود. پارامترهای استاتیک و دینامیک وابسته به KDF برای تابع KDF در کلید `kdfparams` توضیح داده شده است.

PBKDF2 باید توسط تمام پیاده‌سازی‌های دارای حداقل سازگاری پشتیبانی شود، البته به این موارد اشاره شده است:

- `kdf`: `pbkdf2`

kdfparamها برای PBKDF2 عبارتند از:

- `prf`: باید `hmac-sha256` باشد (ممکن است در آینده تمدید شود);
- `c`: تعداد تکرارها؛
- `سالت`: سالت به PBKDF منتقل می شود؛
- `dklen`: طول کلید استخراج شده. باید >=32 باشد.

هنگامی که کلید فایل استخراج شد، باید از طریق استخراج MAC تأیید شود. MAC باید به عنوان هش SHA3 (keccak-256) آرایه بایت محاسبه شود که به عنوان الحاقات 16 بایت دوم سمت چپ کلید استخراج شده با محتویات کلید `متن رمزی` تشکیل شده است، به عنوان مثال.:

```js
KECCAK(DK[16..31] ++ <ciphertext>)
```

(که در آن `++` اپراتور الحاق است)

این مقدار باید با محتویات کلید `mac` مقایسه شود. اگر متفاوت هستند، یک رمز عبور جایگزین باید درخواست شود (یا عملیات لغو شود).

پس از تأیید کلید فایل، متن رمز (کلید `متن رمز` در فایل) ممکن است با استفاده از الگوریتم رمزگذاری متقارن مشخص شده توسط کلید `رمز` رمزگشایی شود و از طریق کلید `پارام رمز` پارامترگذاری شود. اگر اندازه کلید استخراج شده و اندازه کلید الگوریتم با هم مطابقت نداشته باشند، بایت های صفر و سمت راست کلید استخراج شده باید به عنوان کلید الگوریتم استفاده شوند.

همه پیاده‌سازی‌هایی که حداقل مطابقت را دارند باید از الگوریتم AES-128-CTR پشتیبانی کنند که به این صورت مشخص می‌شود:

- `cipher: aes-128-ctr`

این رمز، پارامترهای زیر را می گیرد که به عنوان کلید برای کلید cipherparams داده می شود:

- `iv`: بردار اولیه سازی 128 بیتی برای رمز.

کلید رمز، 16 بایت سمت چپ کلید استخراج شده است، یعنی `DK[0..15]`

ایجاد/رمزگذاری یک کلید مخفی باید اساساً برعکس این دستورالعمل‌ها باشد. مطمئن شوید که `uuid`، `salt` و `iv` واقعا تصادفی هستند.

علاوه بر فیلد `نسخه`، که باید به عنوان یک شناسه "سخت" نسخه عمل کند، پیاده‌سازی‌ها ممکن است از `minorversion` برای ردیابی تغییرات کوچک‌تر و بدون شکست در قالب استفاده کنند.

## بردارهای تست {#test-vectors}

جزئیات:

- `Address`: `008aeeda4d805471df9b2a5b0f38a0c3bcba786b`
- `ICAP`: `XE542A5PZHH8PYIZUBEJEO0MFWRAPPIL67`
- `UUID`: `3198bc9c-6672-5ab3-d9954942343ae5b6`
- `Password`: `testpassword`
- `Secret`: `7a28b5ba57c53603b0b07b56bba752f7784bf506fa95edc395f5cf6c7514fe9d`

### PBKDF2-SHA-256 {#PBKDF2-SHA-256}

آزمایش بردار با استفاده از `AES-128-CTR` و `PBKDF2-SHA-256`:

محتوای فایل `~/.web3/keystore/3198bc9c-6672-5ab3-d9954942343ae5b6.json`:

```json
{
  "crypto": {
    "cipher": "aes-128-ctr",
    "cipherparams": {
      "iv": "6087dab2f9fdbbfaddc31a909735c1e6"
    },
    "ciphertext": "5318b4d5bcd28de64ee5559e671353e16f075ecae9f99c7a79a38af5f869aa46",
    "kdf": "pbkdf2",
    "kdfparams": {
      "c": 262144,
      "dklen": 32,
      "prf": "hmac-sha256",
      "salt": "ae3cd4e7013836a3df6bd7241b12db061dbe2c6785853cce422d148a624ce0bd"
    },
    "mac": "517ead924a9d0dc3124507e3393d175ce3ff7c1e96529c6c555ce9e51205e9b2"
  },
  "id": "3198bc9c-6672-5ab3-d995-4942343ae5b6",
  "version": 3
}
```

**متوسط**:

`Derived key`: `f06d69cdc7da0faffb1008270bca38f5e31891a3a773950e6d0fea48a7188551` `MAC Body`: `e31891a3a773950e6d0fea48a71885515318b4d5bcd28de64ee5559e671353e16f075ecae9f99c7a79a38af5f869aa46` `MAC`: `517ead924a9d0dc3124507e3393d175ce3ff7c1e96529c6c555ce9e51205e9b2` `Cipher key`: `f06d69cdc7da0faffb1008270bca38f5`

### Scrypt {#scrypt}

بردار آزمایشی با استفاده از AES-128-CTR و Scrypt:

```json
{
  "crypto": {
    "cipher": "aes-128-ctr",
    "cipherparams": {
      "iv": "740770fce12ce862af21264dab25f1da"
    },
    "ciphertext": "dd8a1132cf57db67c038c6763afe2cbe6ea1949a86abc5843f8ca656ebbb1ea2",
    "kdf": "scrypt",
    "kdfparams": {
      "dklen": 32,
      "n": 262144,
      "p": 1,
      "r": 8,
      "salt": "25710c2ccd7c610b24d068af83b959b7a0e5f40641f0c82daeb1345766191034"
    },
    "mac": "337aeb86505d2d0bb620effe57f18381377d67d76dac1090626aa5cd20886a7c"
  },
  "id": "3198bc9c-6672-5ab3-d995-4942343ae5b6",
  "version": 3
}
```

**متوسط**:

`کلید استخراج شده`: `7446f59ecc301d2d79bc3302650d8a5cedc185ccbb4bf3ca1ebd2c163eaa6c2d` `MAC Body`: `edc185ccbb4bf3ca1ebd2c163eaa6c2ddd8a1132cf57db67c038c6763afe2cbe6ea1949a86abc5843f8ca656ebbb1ea2` `MAC`: `337aeb86505d2d0bb620effe57f18381377d67d76dac1090626aa5cd20886a7c` `Cipher key`: `7446f59ecc301d2d79bc3302650d8a5c`

## تغییرات از نسخه 1 {#alterations-from-v2}

این نسخه چندین ناسازگاری را با نسخه 1 منتشر شده در [اینجا](https://github.com/ethereum/homestead-guide/blob/master/old-docs-for-reference/go-ethereum-wiki.rst/Passphrase-protected-key-store-spec.rst) برطرف می کند. آنها به طور خلاصه عبارتند از:

- حروف بزرگ غیرقابل توجیه و متناقض است (حروف کوچک رمز، حروف مختلط Kdf، حروف بزرگ MAC).
- به حریم خصوصی و ایرادات غیرضروری می‌پردازد.
- `سالت` ذاتاً یک پارامتر تابع مشتق کلید است و شایسته آن است که با آن مرتبط شود، نه به طور کلی با رمزارز.
- _SaltLen_ غیر ضروری است (فقط آن را از Salt استخراج کنید).
- تابع استخراج کلید داده شده است، اما الگوریتم رمزنگاری به سختی مشخص شده است.
- `نسخه` ذاتاً عددی است و در عین حال یک رشته است (نسخه‌سازی ساختاریافته با یک رشته امکان‌پذیر است، اما می‌تواند برای قالب فایل پیکربندی که به ندرت تغییر می‌کند، خارج از محدوده در نظر گرفته شود).
- `KDF` و `رمز` به طور فکری مفاهيم خواهر و برادر هستند اما به طور متفاوت سازماندهي شده اند.
- `MAC` از طریق یک قطعه داده آگنوستیک فضای خالی محاسبه می شود(!)

برای ارائه فایل زیر، تغییراتی در قالب ایجاد شده است که از نظر عملکردی معادل مثال داده شده در صفحه پیوند قبلی است:

```json
{
  "crypto": {
    "cipher": "aes-128-cbc",
    "ciphertext": "07533e172414bfa50e99dba4a0ce603f654ebfa1ff46277c3e0c577fdc87f6bb4e4fe16c5a94ce6ce14cfa069821ef9b",
    "cipherparams": {
      "iv": "16d67ba0ce5a339ff2f07951253e6ba8"
    },
    "kdf": "scrypt",
    "kdfparams": {
      "dklen": 32,
      "n": 262144,
      "p": 1,
      "r": 8,
      "salt": "06870e5e6a24e183a5c807bd1c43afd86d573f7db303ff4853d135cd0fd3fe91"
    },
    "mac": "8ccded24da2e99a11d48cda146f9cc8213eb423e2ea0d8427f41c3be414424dd",
    "version": 1
  },
  "id": "0498f19a-59db-4d54-ac95-33901b4f1870",
  "version": 2
}
```

## تغییرات از نسخه 2 {#alterations-from-v2}

نسخه 2 یک پیاده سازی اولیه ++C با تعدادی باگ بود. همه موارد ضروری بدون تغییر از آن باقی می مانند.

---
title: Як реалізувати продаж ERC-721
description: Як розмістити марковані елементи для продажу на децентралізовану дошку оголошень
author: "Альберто Гуеста Канада"
tags:
  [
    "Смарт-контракти",
    "erc-721",
    "мова програмування",
    "токени, лексеми"
  ]
skill: intermediate
lang: uk
published: 2020-03-19
source: Hackernoon
sourceUrl: https://hackernoon.com/how-to-implement-an-erc721-market-1e1a32j9
---

У цій статті я збираюся показати Вам, як кодувати Craigslist для блокчейну Ethereum.

До Gumtree, Ebay та Craigslist дошки об'яв були здебільшого виготовлені з пробок чи паперу. Розташовували дошки об'яв у шкільних коридорах, у пресі, на фонарних стовпах, на вітринах.

Все це змінилося з появою Інтернету. Кількість людей, які могли бачити спеціальну дошку об'яв, набагато збільшилася. Разом із тим, продажі, які вони представляють, стали набагато ефективнішими та досягли глобального розміру. Ebay - це масивне торгівельне підприємство, яке бере свій початок саме з цих матеріальних дошок об'яв.

З допомогою блокчейну ці продажі відновлюються ще раз, дозвольте показати Вам, як це відбувається.

## Монетизація {#monetization}

Бізнес-модель загальнодоступної блокчейнової дошки об'яв має відрізнятися від аналогічної на Ebay та інших сервісах.

По-перше, існує [аспект децентралізації](/developers/docs/web2-vs-web3/). Існуючі платформи потребують підтримки власних серверів. Децентралізована платформа підтримується завдяки її користувачам, тому вартість роботи основної платформи знизилася до нуля для її власника.

Потім є передня частина, тобто веб-сайт чи інтерфейс, який надає доступ до платформи. Тут наявна велика кількість варіантів. Власники платформи можуть обмежити доступ та змусити кожного користуватися їхнім інтерфейсом, стягуючи плату. Власники платформи також можуть вирішити відкрити доступ (Владу людям!) і дозволити будь-кому створювати інтерфейси до платформи. Або власники можуть обрати якусь позицію між цими крайнощами.

_Бізнес-лідери з більшою перспективою, ніж в мене, знають, як монетизувати це. Я бачу тільки те, що це різниться від нинішнього стану справ і, ймовірно, є прибутковим._

Більше того, тут наявна автоматизація та вигідні платежі. Деякі речі можна дуже [ефективно токенізувати](https://hackernoon.com/tokenization-of-digital-assets-g0ffk3v8s?ref=hackernoon.com) та торгувати ними на дошці оголошень. Токенізовані активи легко переносяться до блокчейну. У блокчейні можна з легкістю здійснювати дуже складні методи оплати.

Тут мені пахне гарною можливістю для реалізації бізнесу. Дошка об'яв без поточних витрат може бути легко втілена в життя за допомогою складних платіжних шляхів у кожній транзакції. Я впевнений, що хтось запропонує ідею як цим користуватися.

Я дуже щасливий, що створив це. Давайте подивимося на код.

## Реалізація {#implementation}

Деякий час тому ми створили [репозиторій з відкритим кодом](https://github.com/HQ20/contracts?ref=hackernoon.com) з прикладами реалізації бізнес-кейсів та іншими корисними речами, будь ласка, ознайомтеся.

Код для цієї [Дошки оголошень Ethereum](https://github.com/HQ20/contracts/tree/master/contracts/classifieds?ref=hackernoon.com) знаходиться там, будь ласка, вільно використовуйте його. Просто майте на увазі, що код не був перевіреним і Вам потрібно уважно дослідити його перед тим, як надіслати гроші на нього.

Основи дошки не є складними. Усі оголошення на дошці будуть просто конструкцією з кількома полями:

```solidity
struct Trade {
  address poster;
  uint256 item;
  uint256 price;
  bytes32 status; // Відкрита, Виконана, Скасована
}
```

Отже, тут є хтось, хто публікує рекламу. Товар для продажу. Вартість товару. Статус торгівлі, яка може бути відкритою, виконаною чи закритою.

Всі ці торгівельні угоди зберігатимуться у відображенні. Бо все в Solidity схоже на відображення. Через те, що це зручно.

```solidity
mapping(uint256 => Trade) public trades;
```

Використання відображення означає те, що ми повинні запропонувати ідентифікатор для кожного рекламного оголошення перед його публікацією, і нам необхідно знати ідентифікатор для реклами перед тим, як працювати над нею. Існує багато способів боротьби з цим або розумний договір, або фінансовий. Будь ласка, питайте, якщо Вам потрібні певні вказівки.

Далі виникає питання про те, якими є ті товари, з якими ми маємо справу, і якою є ця валюта, що використовується для сплати за транзикцію.

Що стосується елементів, ми просто вимагатимемо, щоб вони реалізовували інтерфейс [ERC-721](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/IERC721.sol?ref=hackernoon.com), що насправді є лише способом представлення предметів реального світу в блокчейні, хоча він [найкраще працює з цифровими активами](https://hackernoon.com/tokenization-of-digital-assets-g0ffk3v8s?ref=hackernoon.com). Ми збираємося вказати свій власний договір ERC721 в конструкторі, зазначаючи, що будь-які активи на нашій дошці об'яв мають бути токенізовані заздалегідь.

Для платежів ми збираємося робити щось подібне. Більшість блокчейн-проєктів визначають власну [ERC-20](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol?ref=hackernoon.com) криптовалюту. Дехто надає перевагу використанню основних криптовалют, як-от DAI. На цій дошці об'яв Вам потрібно вирішити, якою буде Ваша валюта. Легко.

```solidity
constructor (
  address _currencyTokenAddress, address _itemTokenAddress
) public {
  currencyToken = IERC20(_currencyTokenAddress);
  itemToken = IERC721(_itemTokenAddress);
  tradeCounter = 0;
}
```

Ми намагаємося це робити. У нас є рекламні оголошення, товари для продажу і валюта для здійснення платежів. Робити рекламу означає виставляти товар на зберігання, щоб показати одночасно, що Ви це маєте і, що ви не опублікували це вдруге, можливо, на іншій дошці.

Код нижче саме цим і займається. Виставляє товар на зберігання, створює рекламу, робить деяке прибирання.

```solidity
function openTrade(uint256 _item, uint256 _price)
  public
{
  itemToken.transferFrom(msg.sender, address(this), _item);
  trades[tradeCounter] = Trade({
    poster: msg.sender,
    item: _item,
    price: _price,
    status: "Open"
  });
  tradeCounter += 1;
  emit TradeStatusChange(tradeCounter - 1, "Open");
}
```

Прийняти товар означає обрати рекламне оголошення (товар), оплатити його, отримати замовлення. Код нижче призначений для отримання товару. Перевіряє його доступ. Оплачує товар. Отримує товар. Оновлює рекламу.

```solidity
function executeTrade(uint256 _trade)
  public
{
  Trade memory trade = trades[_trade];
  require(trade.status == "Open", "Угода не відкрита.");
  currencyToken.transferFrom(msg.sender, trade.poster, trade.price);
  itemToken.transferFrom(address(this), msg.sender, trade.item);
  trades[_trade].status = "Executed";
  emit TradeStatusChange(_trade, "Executed");
}
```

Урешті-решт ми маємо таку опцію для продавців, як відмовитися від товару, перш ніж покупець зможе його прийняти. У деяких моделях рекламні оголошення замість того, щоб одразу зникнути, будуть "жити" ще деякий час. Це ваш вибір, який залежить від дизайну вашої торгівлі.

Код дуже схожий на той, який використовується для укладання угоди, він відрізняється лише тим, що тут немає валюти, яка переходить з рук в руки, і товар повертається до рекламодавця.

```solidity
function cancelTrade(uint256 _trade)
  public
{
  Trade memory trade = trades[_trade];
  require(
    msg.sender == trade.poster,
    "Угоду може скасувати лише автор."
  );
  require(trade.status == "Open", "Угода не відкрита.");
  itemToken.transferFrom(address(this), trade.poster, trade.item);
  trades[_trade].status = "Cancelled";
  emit TradeStatusChange(_trade, "Cancelled");
}
```

Ось так. Ви робите це до кінця реалізації. Це досить дивно, як деякі компактні бізнес-концепції можуть бути виражені в коді, ось один з таких випадків. Перегляньте повний контракт [у нашому репозиторії](https://github.com/HQ20/contracts/blob/master/contracts/classifieds/Classifieds.sol).

## Висновок {#conclusion}

Дошки об'яв - це поширена ринкова конфігурація, яка стала масово масштабованою в Інтернеті, і є надзвичайно популярною бізнес-моделлю з кількома монополістичними переможцями.

Дошки об'яв також виявилися простим інструментом для відтворення в середовищі блокчейну з дуже конкретними функціями, які кинуть можливий виклик вже існуючим гігантам.

У цій статті я спробував подолати ділову реальність дошок об'яв з технологічним впровадженням. Це знання має допомогти Вам у створенні перспективи і інструкції для реалізації, якщо у Вас є потрібні навички.

Як завжди, якщо Ви збираєтеся створити щось цікаве і хотіли б отримати пораду, будь ласка, [напишіть мені](https://albertocuesta.es/)! Я завжди радий допомогти.

---
title: Gasper
description: "Пояснення механізму підтвердження частки Gasper."
lang: uk
---

Gasper — це комбінація Casper the Friendly Finality Gadget (Casper-FFG) і алгоритму вибору розгалуження LMD-GHOST. Разом ці компоненти утворюють консенсусний механізм, що забезпечує доказ ставки Ethereum. Casper — це механізм, який оновлює певні блоки до «завершених», щоб нові учасники мережі могли бути впевнені, що вони синхронізують канонічний ланцюжок. Алгоритм вибору форка використовує накопичені голоси, щоб вузли могли легко вибрати правильний, коли в блокчейні виникають форки.

**Зверніть увагу,** що оригінальне визначення Casper-FFG було дещо оновлено для включення в Gasper. На цій сторінці розглядаємо оновлену версію.

## Передумови

Щоб зрозуміти цей матеріал, необхідно прочитати вступну сторінку про [доказ частки володіння](/developers/docs/consensus-mechanisms/pos/).

## Роль Gasper {#role-of-gasper}

Гаспер сидить на вершині блокчейну з підтвердженням частки, де вузли надають ефір як гарантійний депозит, який можна знищити, якщо вони ліниві або нечесні, пропонуючи або перевіряючи блоки. Gasper — це механізм, який визначає, як валідатори отримують винагороду та покарання, вирішують, які блоки приймати та відхиляти, а також який форк блокчейну будувати.

## Що таке остаточність? {#what-is-finality}

Завершеність — це властивість певних блоків, яка означає, що їх неможливо повернути, якщо не відбувся критичний збій консенсусу, і зловмисник знищив принаймні 1/3 загального ефіру. Завершені блоки можна розглядати як інформацію, щодо якої блокчейн впевнений. Блок має пройти двоетапну процедуру оновлення, щоб завершити блок:

1. Дві третини від загального поставленого ефіру повинні були проголосувати за включення цього блоку в канонічний ланцюг. Ця умова покращує блок до «вирівняного». Виправдані блоки навряд чи будуть скасовані, але за певних умов це можливо.
2. Коли інший блок вирівнюється поверх вирівняного блоку, він оновлюється до «завершеного». Завершення блоку — це зобов’язання включити блок у канонічний ланцюг. Його неможливо скасувати, якщо зловмисник не знищить мільйони ефірів (мільярди доларів США).

Ці оновлення блоків відбуваються не в кожному слоті. Натомість можна обґрунтувати та завершити лише межі епох. Ці блоки відомі як 'контрольно-пропускні пункти'. Оновлення враховує пари контрольних точок. Між двома послідовними контрольними точками має існувати «зв’язок надбільшості» (тобто дві третини від загального обсягу застейканого ефіру, що голосують за те, що контрольна точка B є правильним нащадком контрольної точки A), щоб оновити менш актуальну контрольну точку до статусу «фіналізована», а більш новий блок — до статусу «обґрунтований».

Оскільки остаточність вимагає згоди на дві третини, що блок є канонічним, зловмисник не може створити альтернативний завершений ланцюжок без:

1. Володіння або маніпулювання двома третинами загального ефіру.
2. Знищення щонайменше однієї третини загального ефіру, що ставиться на ставку.

Перша умова виникає через те, що для завершення ланцюжка потрібні дві третини ефіру, який ставиться на ставку. Друга умова виникає тому, що якщо дві третини загальної частки проголосували за обидва вилки, то одна третина має проголосувати за обидва. Подвійне голосування є різкою умовою, яка буде максимально покарана, і одна третина загальної частки буде знищена. Станом на травень 2022 року для цього зловмисник повинен спалити ефір на суму близько 10 мільярдів доларів. Алгоритм, який обґрунтовує та фіналізує блоки в Gasper, є дещо зміненою формою [Casper the Friendly Finality Gadget (Casper-FFG)](https://arxiv.org/pdf/1710.09437.pdf).

### Стимули та слешинг {#incentives-and-slashing}

Валідатори отримують винагороду за чесну пропозицію та перевірку блоків. Ефір отримує винагороду та додається до їхньої ставки. З іншого боку, валідатори, які відсутні та не діють, коли їх викликають, втрачають ці винагороди, а іноді втрачають невелику частину своєї існуючої частки. Однак штрафи за перебування в автономному режимі невеликі і в більшості випадків дорівнюють альтернативним витратам через відсутність винагород. Однак деякі дії валідатора дуже важко виконати випадково, і вони вказують на зловмисний намір, як-от пропонування кількох блоків для одного слота, підтвердження кількох блоків для одного слота або суперечність попереднім голосуванням контрольних точок. Це «різна» поведінка, яка карається суворіше — скорочення призводить до знищення певної частки валідатора та видалення валідатора з мережі валідаторів. Цей процес займає 36 днів. У день 1, початковий штраф становить до 1 ETH. Потім ефір скороченого валідатора повільно стікає протягом періоду виходу, але на 18 день вони отримують «кореляційний штраф», який стає більшим, коли більше валідаторів скорочуються приблизно в той самий час. Максимальний штраф — уся частка. Ці винагороди та покарання створені, щоб стимулювати чесних валідаторів і перешкоджати атакам у мережі.

### Витік через неактивність {#inactivity-leak}

Крім безпеки, Gasper також забезпечує «правдоподібну жвавість». Це умова, що якщо дві третини від загального ефіру чесно голосують і дотримуються протоколу, ланцюжок зможе завершитися незалежно від будь-якої іншої активності (такої як атаки, проблеми з затримкою або скорочення). Іншими словами, одна третина загального ефіру має бути якимось чином скомпрометована, щоб запобігти завершенню ланцюжка. У Gasper існує додаткова лінія захисту від збою в живучості, відома як «витік неактивності». Цей механізм активується, якщо ланцюжок не вдалося завершити протягом більше чотирьох епох. У валідаторів, які активно не підтверджують мажоритарний ланцюжок, їхня частка поступово втрачається, доки більшість не отримає дві третини загальної частки, гарантуючи, що збої в живучості є лише тимчасовими.

### Вибір форку {#fork-choice}

Оригінальне визначення Casper-FFG включало алгоритм вибору форка, який встановлював правило: `дотримуватися ланцюга, що містить обґрунтовану контрольну точку з найбільшою висотою`, де висота визначається як найбільша відстань від генезис-блока. У Gasper вихідне правило вибору форка застаріло на користь більш складного алгоритму під назвою LMD-GHOST. Важливо розуміти, що за звичайних умов правило вибору форка непотрібне – для кожного слота існує один пропонатор блоку, і чесні валідатори підтверджують це. Лише у випадках великої асинхронності мережі або коли нечесний пропонент блоку помилився, необхідний алгоритм вибору розгалуження. Однак, коли такі випадки все ж виникають, алгоритм вибору форка є критичним захистом, який забезпечує правильний ланцюжок.

LMD-GHOST розшифровується як «останнє кероване повідомленням жадібне найважче спостережене піддерево». Це важкий на жаргоні спосіб визначення алгоритму, який вибирає розгалуження з найбільшою накопиченою вагою атестацій як канонічне (жадібне найважче піддерево), і якщо кілька повідомлень отримано від валідатора, розглядається лише останнє (останнє -повідомлення). Перш ніж додати найважчий блок до свого канонічного ланцюга, кожен валідатор оцінює кожен блок за цим правилом.

## Додаткові матеріали {#further-reading}

- [Gasper: поєднання GHOST і Casper](https://arxiv.org/pdf/2003.03052.pdf)
- [Casper the Friendly Finality Gadget](https://arxiv.org/pdf/1710.09437.pdf)

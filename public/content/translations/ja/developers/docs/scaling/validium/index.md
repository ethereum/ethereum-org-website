---
title: "バリディアム"
description: "現在、イーサリアム・コミュニティで活用されているスケーリングのソリューションとしてのバリディアムを紹介する"
lang: ja
sidebarDepth: 3
---

Validiumは、[ZKロールアップ](/developers/docs/scaling/zk-rollups/)のような有効性証明を使用してトランザクションの完全性を強化する[スケーリングソリューション](/developers/docs/scaling/)ですが、トランザクションデータをイーサリアムメインネットに保存しません。 オフチェーンのデータ可用性にはトレードオフが伴いますが、スケーラビリティの大幅な向上につながる可能性があります(Validiumは[毎秒9,000件以上のトランザクション](https://blog.matter-labs.io/zkrollup-vs-validium-starkex-5614e38bc263)を処理できます)。

## 前提条件{#prerequisites}

[イーサリアムのスケーリング](/developers/docs/scaling/)と[レイヤー2](/layer-2)に関するページを読んで理解しておく必要があります。

## バリディアムとは何か？ {#what-is-validium}

Validiumは、イーサリアムメインネット外でトランザクションを処理してスループットを向上させるように設計された、オフチェーンのデータ可用性と計算を使用するスケーリングソリューションです。 [ゼロ知識ロールアップ](/glossary/#zk-proof) (ZKロールアップ)と同様に、Validiumはイーサリアム上でオフチェーントランザクションを検証するために[ゼロ知識証明](/glossary/#zk-proof)を公開します。 これにより無効な状態遷移の発生を防ぐことができるため、バリディアムチェーンのセキュリティが強化されます。

ゼロ知識証明をはじめとする「有効性証明」は、ZK-SNARK（ゼロ知識であり、簡潔かつ非双方向の知識アーギュメント）またはZK-STARK（ゼロ知識であり、スケーラブルかつ透明性が高い知識アーギュメント）のいずれかに分類されます。 [ゼロ知識証明](https://consensys.net/blog/blockchain-explained/zero-knowledge-proofs-starks-vs-snarks/)の詳細。

バリディアムでは、ユーザーの資金はイーサリアム上のスマートコントラクトで管理されます。 Validiumは、ZKロールアップと同様に、ほぼ瞬時の引き出しが可能です。引き出しリクエストの有効性証明がメインネットで検証されると、ユーザーは[マークル証明](/developers/tutorials/merkle-proofs-for-offline-data-integrity/)を提供することで資金を引き出すことができます。 マークル証明は、ユーザーの引き出しトランザクションが検証済みのトランザクションバッチに含まれていることを検証し、オンチェーンコントラクトが引き出しを処理できるようにします。

一方で、バリディアムでは、ユーザーの資金を凍結し、引き出しを制限することも可能です。 これは、Validiumチェーンのデータ可用性管理者が、ユーザーからオフチェーンの状態データを差し控えた場合に発生する可能性があります。 トランザクションデータにアクセスできないユーザーは、資金の所有権を証明し、出金を実行するのに必要なマークル証明を計算できません。

つまり、データの可用性に関する姿勢が、バリディアムとゼロ知識ロールアップとの最大の違いだと言えます。 これらのソリューションは、データストレージに対して異なるアプローチを採用しているため、セキュリティやトラストレス性にも影響があります。

## バリディアムは、どのようにイーサリアムメインネットとやりとりするのか？ Validiumはイーサリアムとどのように相互作用するのか？ {#how-do-validiums-interact-with-ethereum}

バリディアムは、既存のイーサリアムチェーン上で構築されたスケーリング用のプロトコルです。 Validiumチェーンはオフチェーンでトランザクションを実行しますが、メインネットにデプロイされた次のようなスマートコントラクトの集まりによって管理されます。

1. **検証者コントラクト**：検証者コントラクトは、状態更新を行う際に、Validiumのオペレーターによって提出された証明の有効性を検証します。 これには、オフチェーントランザクションの正しさを証明する有効性証明と、オフチェーントランザクションデータの存在を検証するデータ可用性証明が含まれます。

2. **メインコントラクト**：メインコントラクトは、ブロック生成者から提出された状態コミットメント（マークルルート）を保存し、有効性証明がオンチェーンで検証されるとValidiumの状態を更新します。 メインコントラクトはさらに、バリディアムチェーンからの入金／出金を処理します。

バリディアムでは、さらに以下の機能についてメインのイーサリアムチェーンに依存します：

### 決済 {#settlement}

バリディアム上で実行されたトランザクションは、親チェーンが当該トランザクションの有効性を検証するまでは、完全に確定しません。 バリディアム上で実行されたすべての処理は、最終的にメインネットで決済される必要があります。 イーサリアムブロックチェーンは、Validiumユーザーに「決済保証」も提供します。つまり、オンチェーンにコミットされると、オフチェーントランザクションを覆したり変更したりすることはできません。

### セキュリティ {#security}

イーサリアムはさらに、決済レイヤーとして動作することで、バリディアムの状態遷移についてもその有効性を保証します。 Validiumチェーンで実行されるオフチェーントランザクションは、イーサリアムのベースレイヤー上のスマートコントラクトを介して検証されます。

オンチェーンの検証者コントラクトが証明を無効と判断した場合、トランザクションは拒否されます。 つまり、バリディアムのオペレーターは、バリディアムの状態を更新する事前に、イーサリアムのプロトコルが要求する有効性の条件を満たす必要があります。

## バリディアムはどのように機能するのか？ {#how-does-validium-work}

### トランザクション {#transactions}

各ユーザーは、バリディアムチェーンにおいてトランザクションの実行に責任を負うノードであるオペレーターにトランザクションを送信します。 Validiumによっては、単独のオペレーターを使用してチェーンを実行する場合や、[プルーフ・オブ・ステーク(PoS)](/developers/docs/consensus-mechanisms/pos/)メカニズムに依存してオペレーターをローテーションさせる場合があります。

オペレーターは、複数のトランザクションをバッチ化した上で、検証のために証明サーキットに送信します。 証明サーキットは、このトランザクションバッチ（およびその他の関連データ）をインプットとして受け取り、操作が正しく実行されたことを検証する有効性証明をアウトプットとして出力します。

### 状態コミットメント {#state-commitments}

バリディアムの状態は、ルートがイーサリアムのメインコントラクトに保存されたマークルツリーとしてハッシュ化されます。 マークルルート（ステートルートとも呼ぶ）は、バリディアムチェーンにおける各アカウントおよび残高の現在状態に対する暗号コミットメントの役割を担います。

状態更新を実行するには、オペレーターは（トランザクションを実行した後に）新しい状態ルートを計算し、それをオンチェーンコントラクトに提出する必要があります。 有効性証明が確認されると、提案された状態が承認され、バリディアムが新たな状態ルートに移行します。

### 預け入れと引き出し {#deposits-and-withdrawals}

ユーザーは、オンチェーンコントラクトにETH（または任意のERC互換トークン）を預け入れることで、イーサリアムからValidiumに資金を移動します。 コントラクトは、入金イベントをオフチェーンのValidiumに中継し、ユーザーのアドレスに預け入れ額と同額が貸方記入されます。 オペレーターは同時に、入金トランザクションを新規バッチに追加します。

資金をメインネットに戻したい場合は、バリディアム上で出金トランザクションを開始し、オペレーターに送信します。オペレーターは、この出金リクエストに対して検証を行った上で、次のバッチに追加します。 また、バリディアムチェーン上のユーザー資産は、ユーザーがバリディアムチェーンから退出する事前に破壊されます。 当該バッチに関連付けられた有効性証明が確認だれると、ユーザーはメインのコントラクトを呼び出し、初回のデポジットの残余分を引き出すことができます。

バリディアムのプロトコルでは、検閲耐性のメカニズムとして、ユーザーはオペレーターを介さずに直接バリディアム上のコントラクトから資産を引き出すことが可能です。 この場合、ユーザーは、アカウントが状態ルートに含まれることを示すマークル証明を検証者コントラクトに提供する必要があります。 この証明が承認されれば、ユーザーはメインのコントラクトにおける引き出し関数を呼び出し、バリディアムから資金を退出させることができます。

### バッチ送信 {#batch-submission}

オペレーターは、複数のトランザクションからなるバッチを実行した後、それに関連した有効性証明を検証者コントラクトに送信し、メインのコントラクトに新規のステートルートを提案します。 この証明が有効であれば、メインのコントラクトはバリディアムの状態を更新し、当該バッチに含まれるトランザクションの処理を確定します。

ゼロ知識ロールアップとは異なり、バリディアム上のブロック生成者は、トランザクションを含むバッチのトランザクションデータを公開する必要がありません（ブロックヘッダーのみ公開すればよいです）。 これにより、Validiumは純粋なオフチェーンスケーリングプロトコルとなります。これは、ブロブデータや`calldata`、あるいはその両方の組み合わせを使用して、メインのイーサリアムチェーンに状態データを公開する「ハイブリッド」スケーリングプロトコル（すなわち、[レイヤー2](/layer-2/)）とは対照的です。

### データ可用性 {#data-availability}

前述の通り、Validiumはオフチェーンのデータ可用性モデルを利用しており、オペレーターはすべてのトランザクションデータをイーサリアムメインネット外に保存します。 Validiumのオンチェーンデータフットプリントが小さいことで、スケーラビリティが向上し（スループットはイーサリアムのデータ処理能力に制限されない）、ユーザー手数料が削減されます（オンチェーンでデータを公開するコストが低い）。

しかし、オフチェーンのデータ可用性は、マークル証明の作成や検証に必要なデータが利用できない可能性があるという問題をもたらします。 これは、オペレーターが悪意を持って行動した場合、ユーザーがオンチェーンコントラクトから資金を引き出せなくなる可能性があることを意味します。

様々なバリディアムのソリューションでは、状態データの保存を分散化することでこの問題を解消しようとします。 これには、ブロック生成者に、オフチェーンデータを保存し、リクエストに応じてユーザーが利用できるようにする責任を負う「データ可用性管理者」に基礎となるデータを送信させることを強制することが含まれます。

Validiumのデータ可用性管理者は、すべてのValidiumバッチに署名することで、オフチェーントランザクションのデータの可用性を証明します。 これらの署名は「可用性証明」の一形態を構成し、オンチェーンの検証者コントラクトは状態更新を承認する前にこれをチェックします。

さまざまなバリディアムの実装により、データ可用性の管理アプローチは異なります。 具体的には、信頼できる当事者のみに状態データを保存させる方法と、無作為に指定したバリデータにこのタスクを委任する方法があります。

#### データ可用性委員会(DAC) {#data-availability-committee}

オフチェーンデータの可用性を保証するため、一部のValidiumソリューションでは、データ可用性委員会(DAC)として総称される信頼できるエンティティのグループを任命し、状態のコピーを保存し、データ可用性の証明を提供します。 DACは、メンバーであるユーザーの数が限定されるため、導入やメンバー間の連携が容易になります。

その一方で、通常ユーザーは、データを必要とする際に（例：マークル証明を生成するため）、その可用性についてDACを信頼しなければならなくなります。 データ可用性委員会のメンバーが[悪意のあるアクターによって侵害され](https://notes.ethereum.org/DD7GyItYQ02d0ax_X-UbWg?view)、オフチェーンデータを差し控える可能性があります。

[Validiumにおけるデータ可用性委員会の詳細](https://medium.com/starkware/data-availability-e5564c416424)。

#### ボンド提供型データ可用性 {#bonded-data-availability}

その他のバリディアム実装では、オフラインでのデータ保存を担うユーザーに対し、その役割を引き受ける事前にスマートコントラクト上でトークンをステークする（つまり、ロックアップする）ことを要求しています。 このステークは、データ可用性の管理者における正直な行動を保証するための「ボンド」（担保）として機能するため、信頼性の要求を軽減することができます。 これらの参加者がデータの可用性を証明できない場合、預け入れたボンドは没収されます。

ボンド提供型データ可用性スキームでは、必要なステークを提供すれば、誰でもオフチェーンデータを保持する役割を割り当てられることができます。 これにより、データ可用性の管理者を担えるユーザーの層が拡大するため、データ可用性委員会（DAC）に伴う分散性の低下を抑えることができます。 さらに重要なのは、この暗号経済的なインセンティブにより悪意の行為を抑制するアプローチは、バリディアムにおけるオフラインデータのセキュリティを保証する上で、信頼できるユーザーを指定するアプローチよりもはるかに安全だという点です。

[Validiumにおけるボンド提供型データ可用性の詳細](https://blog.matter-labs.io/zkporter-a-breakthrough-in-l2-scaling-ed5e48842fbf)。

## VolitionとValidium {#volitions-and-validium}

バリディアムは様々な利点を提供する一方で、トレードオフ（特に、データの可用性）も存在します。 他の多くのスケーリング・ソリューションと同様に、バリディアムの様々な実装は具体的なユースケースに合わせて開発されており、そのひとつとしてVolitionsが挙げられます。

Volitionsは、ゼロ知識ロールアップとバリディアムチェーンを組み合わせたサービスであるため、これら2つのスケーリング・ソリューションを使い分けることが可能です。 Volitionを使えば、ユーザーは特定のトランザクションに対してValidiumのオフチェーンデータ可用性を利用しつつ、必要に応じてオンチェーンのデータ可用性ソリューション（ZKロールアップ）に切り替える自由を保持できます。 これにより、ユースケースごとの要請に応じて、どのトレードオフを選択するのかをユーザーが決定できます。

分散型取引所（DEX）の場合、高価値の取引に対してスケーラブルかつプライベートなインフラを提供するバリディアムが適しているかも知れません。 しかし同時に、より高いセキュリティ保証とトラストレス性を望むユーザーのために、ゼロ知識ロールアップを使用することもできます。

## ValidiumとEVM互換性 {#validiums-and-evm-compatibility}

バリディアムは主に、ゼロ知識ロールアップと同じくトークンのスワップや決済といったシンプルな用途に適しています。 [EVM](/developers/docs/evm/)命令をゼロ知識証明回路で証明するには相当なオーバーヘッドがかかるため、Validium間で一般的な計算やスマートコントラクトの実行をサポートすることは実装が困難です。

一部のバリディアムのプロジェクトでは、効率的な証明のために最適化されたカスタムのバイトコードをコンパイルする際にEVM互換の言語（例：Solidity、Vyper）を用いることで、この問題を回避しようとしています。 このアプローチは、ゼロ知識証明に対応したより新しいVMの場合に重要なEVMオペコードをサポートしていない可能性があるため、デベロッパは最善の利用体験を提供するために高レベル言語で直接コーディングしなければならないという欠点があります。 これにより、デベロッパはまったく新しい開発スタックを用いてDappを開発しなければならなくなり、現在のイーサリアム・インフラとの互換性が失われてしまうため、問題がさらに悪化します。

しかし一部の開発チームでは、既存のEVMオペコードをゼロ知識証明サーキットのために最適化する作業を進めています。 この取り組みを通じて、プログラムの正確な実行を証明するEVM互換のVMとしてのゼロ知識イーサリアム仮想マシン（zkEVM）の開発が期待されています。 zkEVMを使用すると、Validiumチェーンはオフチェーンでスマートコントラクトを実行し、有効性証明を提出してイーサリアム上でオフチェーンの計算を（再実行することなく）検証できます。

[zkEVMの詳細](https://www.alchemy.com/overviews/zkevm)。

## バリディアムは、イーサリアムのスケーラビリティをどのように向上させるのか？ Validiumによるイーサリアムのスケーリング {#scaling-ethereum-with-validiums}

### 1. オフチェーンデータストレージ {#offchain-data-storage}

レイヤー2スケーリングプロジェクト(オプティミスティック・ロールアップやZKロールアップなど)では、純粋なオフチェーンスケーリングプロトコル（例：[Plasma](/developers/docs/scaling/plasma/)）の無限のスケーラビリティを犠牲にする代わりに、L1上で一部のトランザクションデータを公開することでセキュリティを確保しています。 しかしこれは、ロールアップのスケーラビリティ特性がイーサリアムメインネットのデータ帯域幅によって制限されることを意味します（このため、[データシャーディング](/roadmap/danksharding/)はイーサリアムのデータストレージ容量を改善することを提案しています）。

Validiumは、すべてのトランザクションデータをオフチェーンに保持し、状態更新をメインのイーサリアムチェーンに中継する際に状態コミットメント（と有効性証明）のみを投稿することで、スケーラビリティを実現します。 しかし、有効性証明の存在により、ValidiumはPlasmaや[サイドチェーン](/developers/docs/scaling/sidechains/)を含む他の純粋なオフチェーンスケーリングソリューションよりも高いセキュリティ保証を提供します。 オフチェーントランザクションを検証する前にイーサリアムが処理しなければならないデータ量を減らすことで、Validiumの設計はメインネットのスループットを大幅に拡張します。

### 2. 再帰的証明 {#recursive-proofs}

再帰的な証明とは、他の証明の有効性を証明する有効性証明です。 このような「証明に対する証明」は、最終的にこれまで作成されたすべての証明を証明できる1つの最終証明が作成されるまで、複数の証明を再帰的に集約することで実行されます。 再帰的証明は、1件の有効性証明で検証できるトランザクションの数を増やすため、ブロックチェーンの処理速度におけるスケーラビリティ向上を実現します。

通常、バリディアムのオペレーターがイーサリアムに提出する有効性証明は、単一のブロック全体を検証します。 これに対し、再帰的証明では、1件の再帰的証明を用いてバリディアム上の複数のブロックの有効性を同時に確認することができます。これは、再帰的証明のサーキットにおいては、複数のブロック証明を1件の最終証明に再帰的に集約できるためです。 オンチェーンの検証者コントラクトが再帰的証明を受け入れた場合、基礎となるすべてのブロックは直ちにファイナライズされます。

## Validiumの長所と短所 {#pros-and-cons-of-validium}

| 長所                                                                   | 短所                                                                                        |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| 有効性証明は、オフチェーントランザクションの完全性を強制し、オペレーターが無効な状態更新をファイナライズするのを防ぎます。        | 有効性証明を生成するには特別なハードウェアが必要なため、分散化が低下するリスクがある。                                               |
| ユーザーがより効率的に資金を利用できる（イーサリアムへの資金引き出しにおいて、遅延が発生しない）。                    | 汎用的な計算／スマートコントラクトに対するサポートが限定的であり、開発には特殊な言語が必要である。                                         |
| 高価値の取引用に用いられる不正証明ベースのシステムを標的とする一部の経済的攻撃に対する脆弱性がない。                   | ゼロ知識証明を生成するには高い処理能力が必要であり、低スループットの用途においてはコスト効率が悪い。                                        |
| calldataをイーサリアムメインネットに送信しないため、ユーザーのガス代が軽減される。                        | ユーザーの主観ではファイナリティを得るまでの時間が長い（ゼロ知識証明を生成するのに10〜30分が必要）が、紛争による遅延が生じないため、完全なファイナリティはより迅速に得られる。 |
| トランザクションにおけるプライバシーやスケーラビリティが重視される資金取引やブロックチェーンゲームなど、特定のユースケースに適している。 | 所有権のマークル証明を生成するには、オフチェーンデータが常に利用可能である必要があるため、ユーザーは資金の引き出しを妨げられる可能性があります。                  |
| オフチェーンのデータ可用性は、より高いレベルのスループットを提供し、スケーラビリティを向上させます。                   | 純粋に暗号論的なセキュリティメカニズムに依存しているゼロ知識ロールアップとは異なり、信頼性の前提と暗号経済的なインセンティブに依存したセキュリティモデルである。          |

### Validium/Volitionの使用 {#use-validium-and-volitions}

複数のプロジェクトにより、Dappに組み込み可能なバリディアムおよびVolitionsの実装が提供されています。

**StarkWare StarkEx** - _StarkExは、有効性証明に基づくイーサリアムのレイヤー2 (L2) スケーラビリティソリューションです。_ ZKロールアップまたはValidiumのデータ可用性モードのいずれかで動作できます。_

- [ドキュメント](https://docs.starkware.co/starkex-v4/starkex-deep-dive/data-availability-modes#validium)
- [ウェブサイト](https://starkware.co/starkex/)

**Matter Labs zkPorter**- _zkPorterは、zkRollupとシャーディングのアイデアを組み合わせたハイブリッドアプローチでデータ可用性に取り組むレイヤー2スケーリングプロトコルです。_ 任意の数のシャードをサポートでき、それぞれが独自のデータ可用性ポリシーを持っています。_

- [ブログ](https://blog.matter-labs.io/zkporter-a-breakthrough-in-l2-scaling-ed5e48842fbf)
- [ドキュメント](https://docs.zksync.io/zksync-protocol/rollup/data-availability)
- [ウェブサイト](https://zksync.io/)

## 参考リンク{#further-reading}

- [Validiumとレイヤー2 Two-By-Two — 第99号](https://www.buildblockchain.tech/newsletter/issues/no-99-validium-and-the-layer-2-two-by-two)
- [ZKロールアップ vs Validium](https://blog.matter-labs.io/zkrollup-vs-validium-starkex-5614e38bc263)
- [Volitionと新たなデータ可用性スペクトラム](https://medium.com/starkware/volition-and-the-emerging-data-availability-spectrum-87e8bfa09bb)
- [ロールアップ、Validium、Volition：最新のイーサリアムスケーリングソリューションについて学ぶ](https://www.defipulse.com/blog/rollups-validiums-and-volitions-learn-about-the-hottest-ethereum-scaling-solutions)
- [イーサリアムロールアップ実践ガイド](https://web.archive.org/web/20241108192208/https://research.2077.xyz/the-practical-guide-to-ethereum-rollups)

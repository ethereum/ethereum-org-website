---
title: "المبادئ التوجيهية الأمنية للعقود الذكية"
description: "قائمة مرجعية لإرشادات الأمان التي يجب مراعاتها عند إنشاء التطبيق اللامركزي الخاص بك"
author: "طريق البتات"
tags: [ "الصلابة", "العقود الذكيه ", "الأمن" ]
skill: intermediate
lang: ar
published: 2020-09-06
source: "عقود البناء الآمنة"
sourceUrl: https://github.com/crytic/building-secure-contracts/blob/master/development-guidelines/guidelines.md
---

اتبع هذه التوصيات عالية المستوى لبناء عقود ذكية أكثر أمانًا.

## إرشادات التصميم {#design-guidelines}

يجب مناقشة تصميم العقد مسبقًا، قبل كتابة أي سطر من التعليمات البرمجية.

### التوثيق والمواصفات {#documentation-and-specifications}

يمكن كتابة التوثيق على مستويات مختلفة، ويجب تحديثه أثناء تنفيذ العقود:

- **وصف بسيط باللغة الإنجليزية للنظام**، يصف ما تفعله العقود وأي افتراضات بشأن قاعدة التعليمات البرمجية.
- **المخططات والرسوم البيانية المعمارية**، بما في ذلك تفاعلات العقود وآلة الحالة للنظام. يمكن أن تساعد [طابعات Slither](https://github.com/crytic/slither/wiki/Printer-documentation) في إنشاء هذه المخططات.
- **توثيق شامل للتعليمات البرمجية**، يمكن استخدام [تنسيق Natspec](https://docs.soliditylang.org/en/develop/natspec-format.html) لـ Solidity.

### الحوسبة على السلسلة مقابل الحوسبة خارج السلسلة {#onchain-vs-offchain-computation}

- **احتفظ بأكبر قدر ممكن من التعليمات البرمجية خارج السلسلة.** أبقِ الطبقة الموجودة على السلسلة صغيرة. عالج البيانات مسبقًا باستخدام التعليمات البرمجية خارج السلسلة بطريقة تجعل التحقق على السلسلة بسيطًا. هل تحتاج إلى قائمة مرتبة؟ قم بفرز القائمة خارج السلسلة، ثم تحقق فقط من الطلب الموجود عليها.

### القابلية للترقية {#upgradeability}

ناقشنا حلول القابلية للترقية المختلفة في [تدوينتنا](https://blog.trailofbits.com/2018/09/05/contract-upgrade-anti-patterns/). قم باختيار متعمد لدعم قابلية الترقية أو عدمها قبل كتابة أي رمز. سيؤثر القرار على كيفية هيكلة تعليماتك البرمجية. بشكل عام، نوصي بما يلي:

- **تفضيل [ترحيل العقود](https://blog.trailofbits.com/2018/10/29/how-contract-migration-works/) على القابلية للترقية.** تتمتع أنظمة الترحيل بالعديد من المزايا نفسها التي تتمتع بها الأنظمة القابلة للترقية، دون عيوبها.
- **استخدام نمط فصل البيانات بدلاً من نمط delegatecallproxy.** إذا كان مشروعك يتمتع بفصل تجريدي واضح، فإن القابلية للترقية باستخدام فصل البيانات ستتطلب تعديلات قليلة فقط. يتطلب وكيل Delecutcall خبرة EVM وهو عرضة للخطأ بشكل كبير.
- **وثِّق إجراء الترحيل/الترقية قبل النشر.** إذا اضطررت إلى التفاعل تحت الضغط دون أي إرشادات، فسوف ترتكب أخطاء. اكتب الإجراء الذي يجب اتباعه مسبقًا. يجب أن تشمل:
  - المكالمات التي تبدأ العقود الجديدة
  - أين يتم تخزين المفاتيح وكيفية الوصول إليها
  - كيفية التحقق من النشر! تطوير واختبار البرنامج النصي بعد النشر.

## إرشادات التنفيذ {#implementation-guidelines}

**اسعَ إلى البساطة.** استخدم دائمًا الحل الأبسط الذي يناسب غرضك. يجب أن يكون أي عضو في فريقك قادرًا على فهم الحل الذي تقدمه.

### تكوين الوظائف {#function-composition}

يجب أن تجعل بنية قاعدة التعليمات البرمجية الخاصة بك من السهل مراجعة التعليمات البرمجية الخاصة بك. تجنب الاختيارات المعمارية التي تقلل من القدرة على التفكير في صحتها.

- **قسِّم منطق نظامك**، إما من خلال عقود متعددة أو عن طريق تجميع الوظائف المتشابهة معًا (على سبيل المثال، المصادقة، الحساب،...).
- **اكتب وظائف صغيرة ذات غرض واضح.** سيسهل هذا المراجعة ويسمح باختبار المكونات الفردية.

### الوراثة {#inheritance}

- **اجعل الوراثة قابلة للإدارة.** يجب استخدام الوراثة لتقسيم المنطق، ولكن يجب أن يهدف مشروعك إلى تقليل عمق وعرض شجرة الوراثة.
- **استخدم [طابعة الوراثة](https://github.com/crytic/slither/wiki/Printer-documentation#inheritance-graph) الخاصة بـ Slither للتحقق من التسلسل الهرمي للعقود.** ستساعدك طابعة الوراثة في مراجعة حجم التسلسل الهرمي.

### الأحداث{#events}

- **سجِّل جميع العمليات الحاسمة.** ستساعد الأحداث في تصحيح أخطاء العقد أثناء التطوير، ومراقبته بعد النشر.

### تجنب المزالق المعروفة {#avoid-known-pitfalls}

- **كن على دراية بأكثر المشكلات الأمنية شيوعًا.** هناك العديد من الموارد المتاحة على الإنترنت للتعرف على المشكلات الشائعة، مثل [Ethernaut CTF](https://ethernaut.openzeppelin.com/) و[Capture the Ether](https://capturetheether.com/) و[Not so smart contracts](https://github.com/crytic/not-so-smart-contracts/).
- **كن على دراية بأقسام التحذيرات في [توثيق Solidity](https://docs.soliditylang.org/en/latest/).** ستُعلِمك أقسام التحذيرات بالسلوك غير الواضح للغة.

### التبعيات {#dependencies}

- **استخدم مكتبات مجرَّبة جيدًا.** سيقلل استيراد التعليمات البرمجية من المكتبات المجربة جيدًا من احتمالية كتابة تعليمات برمجية معيبة. إذا كنت تريد كتابة عقد ERC20، فاستخدم [OpenZeppelin](https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/token/ERC20).
- **استخدم مدير تبعيات؛ وتجنب نسخ ولصق التعليمات البرمجية.** إذا كنت تعتمد على مصدر خارجي، فيجب عليك إبقاؤه محدثًا مع المصدر الأصلي.

### الاختبار والتحقق {#testing-and-verification}

- **اكتب اختبارات وحدة شاملة.** تعد مجموعة الاختبارات الشاملة أمرًا بالغ الأهمية لبناء برمجيات عالية الجودة.
- **اكتب عمليات فحص وخصائص مخصصة لـ [Slither](https://github.com/crytic/slither) و[Echidna](https://github.com/crytic/echidna) و[Manticore](https://github.com/trailofbits/manticore).** ستساعد الأدوات الآلية في ضمان أمان عقدك. قم بمراجعة بقية هذا الدليل لمعرفة كيفية كتابة الشيكات والخصائص الفعالة.
- **استخدم [crytic.io](https://crytic.io/).** يتكامل Crytic مع GitHub، ويوفر الوصول إلى كاشفات Slither الخاصة، ويجري عمليات فحص الخصائص المخصصة من Echidna.

### Solidity {#solidity}

- **فضِّل Solidity 0.5 على 0.4 و 0.6.** في رأينا، يُعد Solidity 0.5 أكثر أمانًا ويتمتع بممارسات مدمجة أفضل من 0.4. لقد أثبت Solidity 0.6 أنه غير مستقر للغاية بالنسبة للإنتاج ويحتاج إلى وقت حتى ينضج.
- **استخدم إصدارًا مستقرًا للتجميع؛ استخدم أحدث إصدار للتحقق من التحذيرات.** تحقق من أن تعليماتك البرمجية لا تحتوي على أي مشكلات مبلغ عنها في أحدث إصدار للمترجم. ومع ذلك، يتمتع Solidity بدورة إصدار سريعة ولديه تاريخ من أخطاء المترجم، لذلك لا نوصي بأحدث إصدار للنشر (راجع [توصية إصدار solc من Slither](https://github.com/crytic/slither/wiki/Detector-Documentation#recommendation-33)).
- **لا تستخدم التجميع المضمن.** يتطلب التجميع خبرة في آلة إيثريوم الافتراضية (EVM). لا تكتب تعليمات برمجية لـ EVM إذا لم تكن قد _أتقنت_ الورقة الصفراء.

## إرشادات النشر {#deployment-guidelines}

بمجرد تطوير العقد ونشره:

- **راقب عقودك.** شاهد السجلات، وكن مستعدًا للتصرف في حالة اختراق العقد أو المحفظة.
- **أضف معلومات الاتصال الخاصة بك إلى [blockchain-security-contacts](https://github.com/crytic/blockchain-security-contacts).** تساعد هذه القائمة الأطراف الخارجية على الاتصال بك في حالة اكتشاف ثغرة أمنية.
- **أمِّن محافظ المستخدمين المميزين.** اتبع [أفضل ممارساتنا](https://blog.trailofbits.com/2018/11/27/10-rules-for-the-secure-use-of-cryptocurrency-hardware-wallets/) إذا كنت تخزن المفاتيح في محافظ الأجهزة.
- **ضع خطة للاستجابة للحوادث.** ضع في اعتبارك أن عقودك الذكية يمكن أن تتعرض للخطر. حتى لو كانت عقودك خالية من الأخطاء، فقد يتحكم أحد المهاجمين في مفاتيح مالك العقد.

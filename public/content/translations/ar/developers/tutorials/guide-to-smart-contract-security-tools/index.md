---
title: "دليل لأدوات أمن العقود الذكية"
description: "نظرة عامة على ثلاث تقنيات مختلفة للاختبار وتحليل البرامج"
author: "طريق البتات"
lang: ar
tags: [ "الصلابة", "العقود الذكيه ", "الأمن" ]
skill: intermediate
published: 2020-09-07
source: "عقود البناء الآمنة"
sourceUrl: https://github.com/crytic/building-secure-contracts/tree/master/program-analysis
---

سوف نستخدم ثلاث تقنيات مميزة للاختبار وتحليل البرامج:

- **التحليل الثابت باستخدام [Slither](/developers/tutorials/how-to-use-slither-to-find-smart-contract-bugs/).** يتم تقريب جميع مسارات البرنامج وتحليلها في نفس الوقت، من خلال عروض مختلفة للبرنامج (على سبيل المثال، الرسم البياني لتدفق التحكم)
- **الاختبار الأعمى (Fuzzing) باستخدام [Echidna](/developers/tutorials/how-to-use-echidna-to-test-smart-contracts/).** يتم تنفيذ النص البرمجي مع توليد شبه عشوائي للمعاملات. سيحاول المُختبِر الأعمى (fuzzer) إيجاد سلسلة من المعاملات لانتهاك خاصية معينة.
- **التنفيذ الرمزي باستخدام [Manticore](/developers/tutorials/how-to-use-manticore-to-find-smart-contract-bugs/).** تقنية تحقق رسمية، والتي تترجم كل مسار تنفيذ إلى صيغة رياضية، والتي يمكن التحقق من القيود عليها.

لكل تقنية مزايا وعيوب، وستكون مفيدة في [حالات محددة](#determining-security-properties):

| التقنية                                      | أدوات     | الاستخدام                                                  | Speed   | الأخطاء التي تم تفويتها | إنذارات كاذبة |
| -------------------------------------------- | --------- | ---------------------------------------------------------- | ------- | ----------------------- | ------------- |
| التحليل الثابت                               | Slither   | واجهة خط الأوامر (CLI) والنصوص البرمجية | seconds | متوسط                   | منخفض         |
| الاختبار الأعمى (Fuzzing) | Echidna   | خصائص Solidity                                             | minutes | منخفض                   | لا شيء        |
| التنفيذ الرمزي                               | Manticore | خصائص Solidity والنصوص البرمجية                            | hours   | لا شيء\*                | لا شيء        |

\* إذا تم استكشاف جميع المسارات دون انتهاء المهلة

**Slither** يحلل العقود في غضون ثوانٍ، ومع ذلك، قد يؤدي التحليل الثابت إلى إنذارات كاذبة وسيكون أقل ملاءمة لعمليات التحقق المعقدة (على سبيل المثال، عمليات التحقق الحسابية). قم بتشغيل Slither عبر واجهة برمجة التطبيقات (API) للوصول السهل إلى الكاشفات المدمجة أو عبر واجهة برمجة التطبيقات (API) لعمليات التحقق التي يحددها المستخدم.

**Echidna** يحتاج إلى التشغيل لعدة دقائق ولن ينتج إلا نتائج إيجابية حقيقية. يتحقق Echidna من خصائص الأمان التي يقدمها المستخدم، والمكتوبة بلغة Solidity. قد يفوت بعض الأخطاء لأنه يعتمد على الاستكشاف العشوائي.

يقوم **Manticore** بإجراء التحليل "الأكثر ثقلاً". مثل Echidna، يتحقق Manticore من الخصائص التي يقدمها المستخدم. سيحتاج إلى مزيد من الوقت للتشغيل، ولكنه يمكنه إثبات صحة خاصية ما ولن يُبلغ عن إنذارات كاذبة.

## سير العمل المقترح {#suggested-workflow}

ابدأ بكاشفات Slither المدمجة للتأكد من عدم وجود أخطاء بسيطة الآن أو سيتم إدخالها لاحقًا. استخدم Slither للتحقق من الخصائص المتعلقة بالوراثة، وتبعيات المتغيرات، والمشكلات الهيكلية. مع نمو قاعدة التعليمات البرمجية، استخدم Echidna لاختبار خصائص أكثر تعقيدًا للجهاز الرئيسي. أعد استخدام Slither لتطوير عمليات تحقق مخصصة للحماية غير المتوفرة من Solidity، مثل الحماية من تجاوز دالة ما. أخيرًا، استخدم Manticore لإجراء تحقق مستهدف لخصائص الأمان الحرجة، على سبيل المثال، العمليات الحسابية.

- استخدم واجهة خط أوامر (CLI) الخاصة بـ Slither لاكتشاف المشكلات الشائعة
- استخدم Echidna لاختبار خصائص الأمان عالية المستوى لعقدك
- استخدم Slither لكتابة عمليات تحقق ثابتة مخصصة
- استخدم Manticore بمجرد أن ترغب في ضمان متعمق لخصائص الأمان الحرجة

**ملاحظة حول اختبارات الوحدة**. تعتبر اختبارات الوحدة ضرورية لبناء برامج عالية الجودة. ومع ذلك، فإن هذه التقنيات ليست الأنسب للعثور على العيوب الأمنية. عادةً ما يتم استخدامها لاختبار السلوكيات الإيجابية للنص البرمجي (أي أن النص البرمجي يعمل كما هو متوقع في السياق العادي)، بينما تميل العيوب الأمنية إلى التواجد في الحالات القصوى التي لم يأخذها المبرمجون في الاعتبار. في دراستنا لعشرات مراجعات أمن العقود الذكية، [لم يكن لتغطية اختبار الوحدة أي تأثير على عدد أو شدة العيوب الأمنية](https://blog.trailofbits.com/2019/08/08/246-findings-from-our-smart-contract-audits-an-executive-summary/) التي وجدناها في النص البرمجي لعملائنا.

## تحديد خصائص الأمان {#determining-security-properties}

لاختبار النص البرمجي الخاص بك والتحقق منه بشكل فعال، يجب عليك تحديد المجالات التي تحتاج إلى اهتمام. نظرًا لأن مواردك التي تنفقها على الأمان محدودة، فإن تحديد الأجزاء الضعيفة أو عالية القيمة من قاعدة التعليمات البرمجية الخاصة بك أمر مهم لتحسين مجهودك. يمكن أن تساعد نمذجة التهديدات. خذ في اعتبارك مراجعة:

- [تقييمات المخاطر السريعة](https://infosec.mozilla.org/guidelines/risk/rapid_risk_assessment.html) (نهجنا المفضل عندما يكون الوقت قصيرًا)
- [دليل نمذجة تهديدات الأنظمة المرتكزة على البيانات](https://csrc.nist.gov/pubs/sp/800/154/ipd) (المعروف أيضًا باسم NIST 800-154)
- [نمذجة تهديدات Shostack](https://www.amazon.com/Threat-Modeling-Designing-Adam-Shostack/dp/1118809998)
- [STRIDE](https://wikipedia.org/wiki/STRIDE_\(security\)) / [DREAD](https://wikipedia.org/wiki/DREAD_\(risk_assessment_model\))
- [PASTA](https://wikipedia.org/wiki/Threat_model#P.A.S.T.A.)
- [استخدام التأكيدات](https://blog.regehr.org/archives/1091)

### المكونات {#components}

معرفة ما تريد التحقق منه سيساعدك أيضًا على تحديد الأداة المناسبة.

تشمل المجالات الواسعة ذات الصلة بشكل متكرر للعقود الذكية ما يلي:

- **الجهاز الرئيسي.** يمكن تمثيل معظم العقود كجهاز رئيسي. ضع في اعتبارك التحقق من أن (1) لا يمكن الوصول إلى أي حالة غير صالحة، (2) إذا كانت الحالة صالحة فيمكن الوصول إليها، و (3) لا توجد حالة تحصر العقد.

  - Echidna و Manticore هما الأداتان المفضلتان لاختبار مواصفات الجهاز الرئيسي.

- **ضوابط الوصول.** إذا كان نظامك يحتوي على مستخدمين مميزين (على سبيل المثال، مالك، وحدات تحكم، ...) يجب عليك التأكد من أن (1) كل مستخدم يمكنه فقط أداء الإجراءات المصرح بها و (2) لا يمكن لأي مستخدم منع الإجراءات من مستخدم أكثر امتيازًا.

  - يمكن لـ Slither و Echidna و Manticore التحقق من ضوابط الوصول الصحيحة. على سبيل المثال، يمكن لـ Slither التحقق من أن الدوال المدرجة في القائمة البيضاء فقط تفتقر إلى مُعدِّل onlyOwner. Echidna و Manticore مفيدان للتحكم في الوصول الأكثر تعقيدًا، مثل إذن يتم منحه فقط إذا وصل العقد إلى حالة معينة.

- **العمليات الحسابية.** التحقق من سلامة العمليات الحسابية أمر بالغ الأهمية. يعد استخدام `SafeMath` في كل مكان خطوة جيدة لمنع التجاوز/التدفق السفلي، ومع ذلك، يجب أن تضع في اعتبارك العيوب الحسابية الأخرى، بما في ذلك مشكلات التقريب والعيوب التي تحصر العقد.

  - Manticore هو الخيار الأفضل هنا. يمكن استخدام Echidna إذا كانت الحسابات خارج نطاق محلل SMT.

- **صحة الوراثة.** تعتمد عقود Solidity بشكل كبير على الوراثة المتعددة. يمكن بسهولة إدخال أخطاء مثل دالة التظليل التي تفتقد إلى استدعاء `super` وسوء تفسير ترتيب الخطية c3.

  - Slither هي الأداة لضمان الكشف عن هذه المشكلات.

- **التفاعلات الخارجية.** تتفاعل العقود مع بعضها البعض، ولا ينبغي الوثوق ببعض العقود الخارجية. على سبيل المثال، إذا كان عقدك يعتمد على أوراكل خارجية، فهل سيبقى آمنًا إذا تم اختراق نصف الأوراكل المتاحة؟

  - Manticore و Echidna هما الخيار الأفضل لاختبار التفاعلات الخارجية مع عقودك. يحتوي Manticore على آلية مدمجة لإنشاء عقود خارجية بديلة.

- **المطابقة القياسية.** معايير إيثريوم (على سبيل المثال ERC20) لها تاريخ من العيوب في تصميمها. كن على دراية بقيود المعيار الذي تبني عليه.
  - سيساعدك Slither و Echidna و Manticore على اكتشاف الانحرافات عن معيار معين.

### ورقة تلخيص اختيار الأداة {#tool-selection-cheatsheet}

| المكون             | أدوات                       | أمثلة                                                                                                                                                                                                                                                                   |
| ------------------ | --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| الجهاز الرئيسي     | Echidna, Manticore          |                                                                                                                                                                                                                                                                         |
| التحكم بالوصول     | Slither, Echidna, Manticore | [تمرين Slither 2](https://github.com/crytic/slither/blob/7f54c8b948c34fb35e1d61adaa1bd568ca733253/docs/src/tutorials/exercise2.md), [تمرين Echidna 2](https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/exercises/Exercise-2.md) |
| العمليات الحسابية  | Manticore, Echidna          | [تمرين Echidna 1](https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/exercises/Exercise-1.md), [تمارين Manticore 1 - 3](https://github.com/crytic/building-secure-contracts/tree/master/program-analysis/manticore/exercises)     |
| صحة الوراثة        | Slither                     | [تمرين Slither 1](https://github.com/crytic/slither/blob/7f54c8b948c34fb35e1d61adaa1bd568ca733253/docs/src/tutorials/exercise1.md)                                                                                                                                      |
| التفاعلات الخارجية | Manticore, Echidna          |                                                                                                                                                                                                                                                                         |
| المطابقة القياسية  | Slither, Echidna, Manticore | [`slither-erc`](https://github.com/crytic/slither/wiki/ERC-Conformance)                                                                                                                                                                                                 |

ستحتاج مجالات أخرى إلى التحقق منها اعتمادًا على أهدافك، لكن مجالات التركيز هذه ذات الحبيبات الخشنة هي بداية جيدة لأي نظام عقد ذكي.

تحتوي عمليات التدقيق العامة لدينا على أمثلة للخصائص التي تم التحقق منها أو اختبارها. ضع في اعتبارك قراءة أقسام `الاختبار والتحقق الآلي` في التقارير التالية لمراجعة خصائص الأمان في العالم الحقيقي:

- [0x](https://github.com/trailofbits/publications/blob/master/reviews/0x-protocol.pdf)
- [Balancer](https://github.com/trailofbits/publications/blob/master/reviews/BalancerCore.pdf)

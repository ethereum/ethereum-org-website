---
title: "تعلم مواضيع إيثريوم التأسيسية باستخدام SQL"
description: "يساعد هذا البرنامج التعليمي القراء على فهم مفاهيم إيثريوم الأساسية بما في ذلك المعاملات والكتل والغاز عن طريق الاستعلام عن البيانات الموجودة على السلسلة باستخدام لغة الاستعلام المهيكلة (SQL)."
author: "Paul Apivat"
tags: [ "SQL", "الاستعلام", "المعاملات" ]
skill: beginner
lang: ar
published: 2021-05-11
source: paulapivat.com
sourceUrl: https://paulapivat.com/post/query_ethereum/
---

تستهدف العديد من البرامج التعليمية الخاصة بإيثريوم المطورين، ولكن هناك نقص في الموارد التعليمية لمحللي البيانات أو للأشخاص الذين يرغبون في رؤية البيانات الموجودة على السلسلة دون تشغيل عميل أو عقدة.

يساعد هذا البرنامج التعليمي القراء على فهم مفاهيم إيثريوم الأساسية بما في ذلك المعاملات والكتل والغاز عن طريق الاستعلام عن البيانات الموجودة على السلسلة باستخدام لغة الاستعلام المهيكلة (SQL) من خلال واجهة مقدمة من [Dune Analytics](https://dune.com/).

يمكن أن تساعدنا البيانات الموجودة على السلسلة في فهم إيثريوم والشبكة وكاقتصاد لقوة الحوسبة، ويجب أن تكون بمثابة أساس لفهم التحديات التي تواجه إيثريوم اليوم (مثل ارتفاع أسعار الغاز)، والأهم من ذلك، المناقشات حول حلول التوسع.

### المعاملات {#transactions}

تبدأ رحلة المستخدم على إيثريوم بتهيئة حساب يتحكم فيه المستخدم أو كيان برصيد ETH. هناك نوعان من الحسابات - يتحكم فيها المستخدم أو عقد ذكي (انظر [ethereum.org](/developers/docs/accounts/)).

يمكن عرض أي حساب على مستكشف الكتل مثل [Etherscan](https://etherscan.io/) أو [Blockscout](https://eth.blockscout.com/). مستكشفات الكتل هي بوابة لبيانات إيثريوم. يعرضون، في الوقت الفعلي، بيانات عن الكتل والمعاملات والمعدنين والحسابات وغيرها من الأنشطة على السلسلة (انظر [هنا](/developers/docs/data-and-analytics/block-explorers/)).

ومع ذلك، قد يرغب المستخدم في الاستعلام عن البيانات مباشرة للتوفيق بين المعلومات التي توفرها مستكشفات الكتل الخارجية. توفر [Dune Analytics](https://dune.com/) هذه الإمكانية لأي شخص لديه بعض المعرفة بلغة SQL.

كمرجع، يمكن عرض حساب العقد الذكي لمؤسسة إيثريوم (EF) على [Blockscout](https://eth.blockscout.com/address/0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe).

شيء واحد يجب ملاحظته هو أن جميع الحسابات، بما في ذلك حسابات مؤسسة إيثريوم (EF)، لها عنوان عام يمكن استخدامه لإرسال واستلام المعاملات.

يتكون رصيد الحساب على Etherscan من معاملات عادية ومعاملات داخلية. المعاملات الداخلية، على الرغم من الاسم، ليست معاملات _فعلية_ تغير حالة السلسلة. إنها عمليات تحويل قيمة يتم بدؤها عن طريق تنفيذ عقد ([المصدر](https://ethereum.stackexchange.com/questions/3417/how-to-get-contract-internal-transactions)). نظرًا لأن المعاملات الداخلية لا تحتوي على توقيع، فهي **غير** مدرجة في البلوكتشين ولا يمكن الاستعلام عنها باستخدام Dune Analytics.

لذلك، سيركز هذا البرنامج التعليمي على المعاملات العادية. يمكن الاستعلام عن ذلك على النحو التالي:

```sql
WITH temp_table AS (
SELECT
    hash,
    block_number,
    block_time,
    "from",
    "to",
    value / 1e18 AS ether,
    gas_used,
    gas_price / 1e9 AS gas_price_gwei
FROM ethereum."transactions"
WHERE "to" = '\xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe'
ORDER BY block_time DESC
)
SELECT
    hash,
    block_number,
    block_time,
    "from",
    "to",
    ether,
    (gas_used * gas_price_gwei) / 1e9 AS txn_fee
FROM temp_table
```

سيؤدي هذا إلى الحصول على نفس المعلومات المتوفرة في صفحة معاملات Etherscan. للمقارنة، إليك المصدران:

#### Etherscan {#etherscan}

![](./etherscan_view.png)

[صفحة عقد EF على Blockscout.](https://eth.blockscout.com/address/0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe)

#### Dune Analytics {#dune-analytics}

![](./dune_view.png)

يمكنك العثور على لوحة المعلومات [هنا](https://dune.com/paulapivat/Learn-Ethereum). انقر فوق الجدول لرؤية الاستعلام (انظر أعلاه أيضًا).

### تحليل المعاملات {#breaking_down_transactions}

تتضمن المعاملة المقدمة عدة أجزاء من المعلومات بما في ذلك ([المصدر](/developers/docs/transactions/)):

- **المستلم**: عنوان الاستلام (يتم الاستعلام عنه كـ "to")
- **التوقيع**: بينما تقوم المفاتيح الخاصة للمرسل بتوقيع معاملة، ما يمكننا الاستعلام عنه باستخدام SQL هو العنوان العام للمرسل ("from").
- **القيمة**: هذا هو مقدار ETH المحول (انظر عمود `ether`).
- **البيانات**: هذه بيانات عشوائية تم تجزئتها (انظر عمود `data`)
- **gasLimit** - الحد الأقصى لوحدات الغاز التي يمكن أن تستهلكها المعاملة. تمثل وحدات الغاز خطوات حسابية
- **maxPriorityFeePerGas** - الحد الأقصى لمقدار الغاز الذي سيتم تضمينه كإكرامية للمعدِّن
- **maxFeePerGas** - الحد الأقصى لمقدار الغاز الذي يرغب المستخدم في دفعه مقابل المعاملة (بما في ذلك baseFeePerGas و maxPriorityFeePerGas)

يمكننا الاستعلام عن هذه الأجزاء المحددة من المعلومات للمعاملات إلى العنوان العام لمؤسسة إيثريوم:

```sql
SELECT
    "to",
    "from",
    value / 1e18 AS ether,
    data,
    gas_limit,
    gas_price / 1e9 AS gas_price_gwei,
    gas_used,
    ROUND(((gas_used / gas_limit) * 100),2) AS gas_used_pct
FROM ethereum."transactions"
WHERE "to" = '\xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe'
ORDER BY block_time DESC
```

### الكتل {#blocks}

ستغير كل معاملة حالة آلة إيثريوم الافتراضية ([EVM](/developers/docs/evm/)) ([المصدر](/developers/docs/transactions/)). يتم بث المعاملات إلى الشبكة للتحقق منها وإدراجها في كتلة. ترتبط كل معاملة برقم كتلة. لرؤية البيانات، يمكننا الاستعلام عن رقم كتلة معين: 12396854 (أحدث كتلة بين معاملات مؤسسة إيثريوم وقت كتابة هذا التقرير، 11/5/21).

علاوة على ذلك، عندما نستعلم عن الكتلتين التاليتين، يمكننا أن نرى أن كل كتلة تحتوي على تجزئة الكتلة السابقة (أي، التجزئة الأصلية)، مما يوضح كيفية تشكيل البلوكتشين.

تحتوي كل كتلة على مرجع للكتلة الأصلية الخاصة بها. يظهر هذا أدناه بين عمودي `hash` و`parent_hash` ([المصدر](/developers/docs/blocks/)):

![parent_hash](./parent_hash.png)

إليك [الاستعلام](https://dune.com/queries/44856/88292) على Dune Analytics:

```sql
SELECT
   time,
   number,
   hash,
   parent_hash,
   nonce
FROM ethereum."blocks"
WHERE "number" = 12396854 OR "number" = 12396855 OR "number" = 12396856
LIMIT 10
```

يمكننا فحص كتلة عن طريق الاستعلام عن الوقت ورقم الكتلة والصعوبة والتجزئة والتجزئة الأصلية والنانس.

الشيء الوحيد الذي لا يغطيه هذا الاستعلام هو _قائمة المعاملات_ التي تتطلب استعلامًا منفصلاً أدناه و_جذر الحالة_. ستقوم العقدة الكاملة أو الأرشيفية بتخزين جميع المعاملات وانتقالات الحالة، مما يسمح للعملاء بالاستعلام عن حالة السلسلة في أي وقت. نظرًا لأن هذا يتطلب مساحة تخزين كبيرة، يمكننا فصل بيانات السلسلة عن بيانات الحالة:

- بيانات السلسلة (قائمة الكتل والمعاملات)
- بيانات الحالة (نتيجة انتقال حالة كل معاملة)

يقع جذر الحالة في الفئة الأخيرة وهو بيانات _ضمنية_ (غير مخزنة على السلسلة)، في حين أن بيانات السلسلة صريحة ومخزنة على السلسلة نفسها ([المصدر](https://ethereum.stackexchange.com/questions/359/where-is-the-state-data-stored)).

بالنسبة لهذا البرنامج التعليمي، سنركز على البيانات الموجودة على السلسلة والتي _يمكن_ الاستعلام عنها باستخدام SQL عبر Dune Analytics.

كما هو مذكور أعلاه، تحتوي كل كتلة على قائمة بالمعاملات، ويمكننا الاستعلام عن ذلك عن طريق التصفية لكتلة معينة. سنجرب أحدث كتلة، 12396854:

```sql
SELECT * FROM ethereum."transactions"
WHERE block_number = 12396854
ORDER BY block_time DESC`
```

إليك مخرجات SQL على Dune:

![](./list_of_txn.png)

تؤدي إضافة هذه الكتلة الواحدة إلى السلسلة إلى تغيير حالة آلة إيثريوم الافتراضية ([EVM](/developers/docs/evm/)). يتم التحقق من عشرات، وأحيانًا مئات، من المعاملات دفعة واحدة. في هذه الحالة المحددة، تم تضمين 222 معاملة.

لمعرفة عدد المعاملات التي نجحت بالفعل، سنضيف عامل تصفية آخر لحساب المعاملات الناجحة:

```sql
WITH temp_table AS (
    SELECT * FROM ethereum."transactions"
    WHERE block_number = 12396854 AND success = true
    ORDER BY block_time DESC
)
SELECT
    COUNT(success) AS num_successful_txn
FROM temp_table
```

بالنسبة للكتلة 12396854، من إجمالي 222 معاملة، تم التحقق بنجاح من 204 معاملة:

![](./successful_txn.png)

تحدث طلبات المعاملات عشرات المرات في الثانية، ولكن يتم الالتزام بالكتل مرة واحدة كل 15 ثانية تقريبًا ([المصدر](/developers/docs/blocks/)).

للتأكد من إنتاج كتلة واحدة كل 15 ثانية تقريبًا، يمكننا أخذ عدد الثواني في اليوم (86400) وقسمته على 15 للحصول على متوسط عدد الكتل المقدر يوميًا (حوالي 5760).

الرسم البياني لكتل إيثريوم المنتجة يوميًا (2016 - حتى الآن) هو:

![](./daily_blocks.png)

متوسط عدد الكتل المنتجة يوميًا خلال هذه الفترة الزمنية هو ~5,874:

![](./avg_daily_blocks.png)

الاستعلامات هي:

```sql
# استعلام لتصوير عدد الكتل المنتجة يوميًا منذ 2016

SELECT
    DATE_TRUNC('day', time) AS dt,
    COUNT(*) AS block_count
FROM ethereum."blocks"
GROUP BY dt
OFFSET 1

# متوسط عدد الكتل المنتجة يوميًا

WITH temp_table AS (
SELECT
    DATE_TRUNC('day', time) AS dt,
    COUNT(*) AS block_count
FROM ethereum."blocks"
GROUP BY dt
OFFSET 1
)
SELECT
    AVG(block_count) AS avg_block_count
FROM temp_table
```

متوسط عدد الكتل المنتجة يوميًا منذ عام 2016 أعلى قليلاً من هذا الرقم عند 5,874. بدلاً من ذلك، فإن قسمة 86400 ثانية على 5874 متوسط كتل ينتج عنها 14.7 ثانية أو كتلة واحدة تقريبًا كل 15 ثانية.

### الغاز {#gas}

الكتل محدودة الحجم. الحد الأقصى لحجم الكتلة ديناميكي ويختلف وفقًا لطلب الشبكة بين 12,500,000 و 25,000,000 وحدة. الحدود مطلوبة لمنع أحجام الكتل الكبيرة بشكل عشوائي من وضع ضغط على العقد الكاملة من حيث مساحة القرص ومتطلبات السرعة ([المصدر](/developers/docs/blocks/)).

إحدى طرق تصور حد غاز الكتلة هي التفكير فيه على أنه **العرض** لمساحة الكتلة المتاحة لتجميع المعاملات. يمكن الاستعلام عن حد غاز الكتلة وتصويره من عام 2016 حتى يومنا هذا:

![](./avg_gas_limit.png)

```sql
SELECT
    DATE_TRUNC('day', time) AS dt,
    AVG(gas_limit) AS avg_block_gas_limit
FROM ethereum."blocks"
GROUP BY dt
OFFSET 1
```

ثم هناك الغاز الفعلي المستخدم يوميًا للدفع مقابل الحوسبة التي تتم على سلسلة إيثريوم (أي إرسال معاملة، أو استدعاء عقد ذكي، أو سك رمز غير قابل للاستبدال). هذا هو **الطلب** على مساحة كتل إيثريوم المتاحة:

![](./daily_gas_used.png)

```sql
SELECT
    DATE_TRUNC('day', time) AS dt,
    AVG(gas_used) AS avg_block_gas_used
FROM ethereum."blocks"
GROUP BY dt
OFFSET 1
```

يمكننا أيضًا وضع هذين المخططين معًا لمعرفة كيفية توافق **الطلب والعرض**:

![gas_demand_supply](./gas_demand_supply.png)

لذلك يمكننا فهم أسعار الغاز كدالة للطلب على مساحة كتل إيثريوم، مع الأخذ في الاعتبار العرض المتاح.

أخيرًا، قد نرغب في الاستعلام عن متوسط أسعار الغاز اليومية لسلسلة إيثريوم، ومع ذلك، سيؤدي القيام بذلك إلى وقت استعلام طويل بشكل خاص، لذلك سنقوم بتصفية استعلامنا إلى متوسط كمية الغاز المدفوعة لكل معاملة من قبل مؤسسة إيثريوم.

![](./ef_daily_gas.png)

يمكننا أن نرى أسعار الغاز المدفوعة لجميع المعاملات التي تمت على عنوان مؤسسة إيثريوم على مر السنين. إليك الاستعلام:

```sql
SELECT
    block_time,
    gas_price / 1e9 AS gas_price_gwei,
    value / 1e18 AS eth_sent
FROM ethereum."transactions"
WHERE "to" = '\xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe'
ORDER BY block_time DESC
```

### ملخص {#summary}

من خلال هذا البرنامج التعليمي، نفهم مفاهيم إيثريوم الأساسية وكيف تعمل بلوكتشين إيثريوم عن طريق الاستعلام والحصول على فكرة عن البيانات الموجودة على السلسلة.

يمكن العثور على لوحة المعلومات التي تحتوي على كل التعليمات البرمجية المستخدمة في هذا البرنامج التعليمي [هنا](https://dune.com/paulapivat/Learn-Ethereum).

لمزيد من استخدام البيانات لاستكشاف Web3 [ابحث عني على تويتر](https://twitter.com/paulapivat).

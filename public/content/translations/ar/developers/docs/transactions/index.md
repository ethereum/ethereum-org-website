---
title: "المعاملات"
description: "نظرة عامة على معاملات إيثيريوم - كيفية عملها، وهيكل بياناتها وكيفية إرسالها عبر تطبيق."
lang: ar
---

المعاملات هي تعليمات من الحسابات موقعة بشكل مشفّر. نشكرك على مشاركتك في برنامج الترجمة ethereum.org. أبسط معاملة هي نقل ETH من حساب إلى آخر.

## المتطلبات الأساسية {#prerequisites}

لمساعدتك في فهم هذه الصفحة بشكل أفضل، نوصيك أولاً بقراءة [الحسابات](/developers/docs/accounts/) و[مقدمة إلى Ethereum](/developers/docs/intro-to-ethereum/).

## ما هي المعاملة؟ {#whats-a-transaction}

تشير معاملة Ethereum إلى إجراء بدأ بواسطة حساب مملوك خارجيًا، أو بعبارة أخرى حساب يديره شخص، وليس عقدًا. على سبيل المثال، إذا أرسل بوب 1 ETH إلى أليس، فيجب خصم المبلغ من حساب بوب وإضافة المبلغ إلى حساب أليس. يحدث هذا الإجراء لتغيير الحالة داخل معاملة.

![رسم بياني يوضح تغيير حالة سبب المعاملة](./tx.png)
_رسم بياني مقتبس من [Ethereum EVM illustrated](https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf)_

يجب بث المعاملات التي تؤدي إلى تغيير حالة EVM إلى الشبكة بأكملها. يمكن لأي عقدة بث طلب لتنفيذ معاملة على EVM؛ بعد حدوث ذلك، سيقوم المحقق بتنفيذ المعاملة ونشر تغيير الحالة الناتج إلى بقية الشبكة.

تتطلب المعاملات رسومًا ويجب تضمينها في كتلة معتمدة. لتبسيط هذه النظرة العامة، سنقوم بتغطية رسوم الغاز والتحقق منها في مكان آخر.

تتضمن المعاملة المقدمة المعلومات التالية:

- `from` – عنوان المرسل، الذي سيوقع المعاملة. This will be an externally-owned account as contract accounts cannot send transactions
- `to` – عنوان المستلم (إذا كان حسابًا مملوكًا خارجيًا، فستقوم المعاملة بتحويل القيمة. إذا كان حساب عقد، سيتم تنفيذ المعاملة بواسطة رمز العقد)
- `signature` – معرّف المرسل. يتم إنشاء ذلك عندما يوقع المفتاح الخاص للمرسل على المعاملة ويؤكد أن المرسل قد سمح بهذه المعاملة
- `nonce` - عداد يزداد بشكل تسلسلي ويشير إلى رقم المعاملة من الحساب
- `value` – كمية الإيثريوم (ETH) المراد تحويلها من المرسل إلى المستلم (مُقوَّمة بعملة WEI، حيث 1ETH يساوي 1e+18wei)
- `input data` – حقل اختياري لتضمين بيانات عشوائية
- `gasLimit` – الحد الأقصى لوحدات الغاز التي يمكن أن تستهلكها المعاملة. تحدد [آلة الإيثريوم الافتراضية (EVM)](/developers/docs/evm/opcodes) وحدات الغاز المطلوبة لكل خطوة حسابية
- `maxPriorityFeePerGas` - الحد الأقصى لسعر الغاز المستهلك ليتم تضمينه كإكرامية للمدقق
- `maxFeePerGas` - الحد الأقصى للرسوم لكل وحدة غاز المدفوعة مقابل المعاملة (بما في ذلك `baseFeePerGas` و`maxPriorityFeePerGas`)

الغاز هو إشارة إلى الحساب المطلوب لمعالجة المعاملة بواسطة المحقق. يتعين على المستخدمين دفع رسوم مقابل هذا الحساب. يحدد `gasLimit` و `maxPriorityFeePerGas` الحد الأقصى لرسوم المعاملة المدفوعة للمدقق. [المزيد عن الغاز](/developers/docs/gas/).

سيبدو كائن المعاملة قليلاً مثل هذا:

```js
{
  from: "0xEA674fdDe714fd979de3EdF0F56AA9716B898ec8",
  to: "0xac03bb73b6a9e108530aff4df5077c2b3d481e5a",
  gasLimit: "21000",
  maxFeePerGas: "300",
  maxPriorityFeePerGas: "10",
  nonce: "0",
  value: "10000000000"
}
```

ولكن يجب توقيع كائن المعاملة باستخدام المفتاح الخاص للمرسل. وهذا يثبت أن المعاملة لا يمكن أن تأتي إلا من المرسل ولم يتم إرسالها بطريقة احتيالية.

سيتولى عميل Ethereum مثل Geth عملية التوقيع هذه.

مثال على استدعاء [JSON-RPC](/developers/docs/apis/json-rpc):

```json
{
  "id": 2,
  "jsonrpc": "2.0",
  "method": "account_signTransaction",
  "params": [
    {
      "from": "0x1923f626bb8dc025849e00f99c25fe2b2f7fb0db",
      "gas": "0x55555",
      "maxFeePerGas": "0x1234",
      "maxPriorityFeePerGas": "0x1234",
      "input": "0xabcd",
      "nonce": "0x0",
      "to": "0x07a565b7ed7d7a678680a4c162885bedbb695fe0",
      "value": "0x1234"
    }
  ]
}
```

مثال على الاستجابة:

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "raw": "0xf88380018203339407a565b7ed7d7a678680a4c162885bedbb695fe080a44401a6e4000000000000000000000000000000000000000000000000000000000000001226a0223a7c9bcf5531c99be5ea7082183816eb20cfe0bbc322e97cc5c7f71ab8b20ea02aadee6b34b45bb15bc42d9c09de4a6754e7000908da72d48cc7704971491663",
    "tx": {
      "nonce": "0x0",
      "maxFeePerGas": "0x1234",
      "maxPriorityFeePerGas": "0x1234",
      "gas": "0x55555",
      "to": "0x07a565b7ed7d7a678680a4c162885bedbb695fe0",
      "value": "0x1234",
      "input": "0xabcd",
      "v": "0x26",
      "r": "0x223a7c9bcf5531c99be5ea7082183816eb20cfe0bbc322e97cc5c7f71ab8b20e",
      "s": "0x2aadee6b34b45bb15bc42d9c09de4a6754e7000908da72d48cc7704971491663",
      "hash": "0xeba2df809e7a612a0a0d444ccfa5c839624bdc00dd29e3340d46df3870f8a30e"
    }
  }
}
```

- `raw` هي المعاملة الموقعة بصيغة [بادئة الطول المتكرر (RLP)](/developers/docs/data-structures-and-encoding/rlp) المشفرة
- `tx` هي المعاملة الموقعة بصيغة JSON

باستخدام تجزئة التوقيع، يمكن إثبات المعاملة تشفيريًا على أنها جاءت من المرسل وتم إرسالها إلى الشبكة.

### حقل البيانات {#the-data-field}

تتم الغالبية العظمى من المعاملات من خلال حساب مملوك خارجيًا.
تُكتب معظم العقود بلغة Solidity وتفسر حقل بياناتها وفقًا لـ [واجهة التطبيق الثنائية (ABI)](/glossary/#abi).

تحدد البايتات الأربعة الأولى الوظيفة التي سيتم استدعاؤها، باستخدام تجزئة اسم الوظيفة والحجج.
يمكنك أحيانًا تحديد الوظيفة من المحدد باستخدام [قاعدة البيانات هذه](https://www.4byte.directory/signatures/).

بقية بيانات الاستدعاء هي الوسائط، [المشفرة كما هو محدد في مواصفات واجهة التطبيق الثنائية (ABI)](https://docs.soliditylang.org/en/latest/abi-spec.html#formal-specification-of-the-encoding).

على سبيل المثال، دعنا نلقي نظرة على [هذه المعاملة](https://etherscan.io/tx/0xd0dcbe007569fcfa1902dae0ab8b4e078efe42e231786312289b1eee5590f6a1).
استخدم **انقر لرؤية المزيد** لرؤية بيانات الاستدعاء.

محدد الوظيفة هو `0xa9059cbb`. هناك العديد من [الوظائف المعروفة بهذا التوقيع](https://www.4byte.directory/signatures/?bytes4_signature=0xa9059cbb).
في هذه الحالة، تم تحميل [النص البرمجي المصدري للعقد](https://etherscan.io/address/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48#code) إلى Etherscan، لذلك نحن نعلم أن الوظيفة هي `transfer(address,uint256)`.

أما بقية البيانات فهي:

```
0000000000000000000000004f6742badb049791cd9a37ea913f2bac38d01279
000000000000000000000000000000000000000000000000000000003b0559f4
```

وفقًا لمواصفات ABI، تظهر القيم الصحيحة (مثل العناوين، والتي هي أعداد صحيحة مكونة من 20 بايتًا) في ABI ككلمات مكونة من 32 بايتًا، مبطنة بأصفار في المقدمة.
لذا، فنحن نعلم أن عنوان `to` هو [`4f6742badb049791cd9a37ea913f2bac38d01279`](https://etherscan.io/address/0x4f6742badb049791cd9a37ea913f2bac38d01279).
قيمة `value` هي 0x3b0559f4 = 990206452.

## أنواع المعاملات {#types-of-transactions}

يوجد على Ethereum أنواع مختلفة من المعاملات:

- المعاملات العادية: معاملة من حساب إلى آخر.
- معاملات نشر العقد: معاملة بدون عنوان "إلى"، حيث يتم استخدام حقل البيانات لكود العقد.
- تنفيذ العقد: معاملة تتفاعل مع عقد ذكي تم نشره. في هذه الحالة، عنوان "إلى" هو عنوان العقد الذكي.

### عن الغاز {#on-gas}

كما ذكرنا، تستهلك المعاملات [الغاز](/developers/docs/gas/) لتنفيذها. تتطلب معاملات النقل البسيطة 21000 وحدة غاز.

لذلك، لكي يرسل Bob إلى Alice عملة ETH واحدة بسعر `baseFeePerGas` يبلغ 190 gwei و`maxPriorityFeePerGas` يبلغ 10 gwei، سيحتاج Bob إلى دفع الرسوم التالية:

```
(١٩٠ + ١٠) * ٢١٠٠٠ = ٤,٢٠٠,٠٠٠ وي --أو-- ٠.٠٠٤٢ إيثريوم
```

سيتم خصم **-1.0042 ETH** من حساب Bob (1 ETH لـ Alice + 0.0042 ETH رسوم الغاز)

سيضاف إلى حساب Alice مبلغ **+1.0 ETH**

سيتم حرق الرسوم الأساسية **-0.00399 ETH**

يحتفظ المدقق بالإكرامية **+0.000210 ETH**

![رسم بياني يوضح كيفية استرداد الغاز غير المستخدم](./gas-tx.png)
_رسم بياني مقتبس من [Ethereum EVM illustrated](https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf)_

يتم إرجاع أي غاز غير مستخدم في المعاملة إلى حساب المستخدم.

### تفاعلات العقود الذكية {#smart-contract-interactions}

يُعد الغاز ضروريًا لأي معاملة تتضمن عقدًا ذكيًا.

يمكن أن تحتوي العقود الذكية أيضًا على وظائف تُعرف بوظائف [`view`](https://docs.soliditylang.org/en/latest/contracts.html#view-functions) أو [`pure`](https://docs.soliditylang.org/en/latest/contracts.html#pure-functions)، والتي لا تغير حالة العقد. وعلى هذا النحو، فإن استدعاء هذه الوظائف من EOA لن يتطلب أي غاز. استدعاء RPC الأساسي لهذا السيناريو هو [`eth_call`](/developers/docs/apis/json-rpc#eth_call).

على عكس عند الوصول إليها باستخدام `eth_call`، يتم أيضًا استدعاء وظائف `view` أو `pure` هذه بشكل شائع داخليًا (أي من العقد نفسه أو من عقد آخر)، مما يكلف الغاز.

## دورة حياة المعاملة {#transaction-lifecycle}

بمجرد تقديم المعاملة يحدث ما يلي:

1. يتم إنشاء تجزئة المعاملة بشكل مشفر:
   `0x97d99bc7729211111a21b12c933c949d4f31684f1d6954ff477d0477538ff017`
2. يتم بعد ذلك بث المعاملة إلى الشبكة وإضافتها إلى مجموعة المعاملات المكونة من جميع معاملات الشبكة المعلقة الأخرى.
3. يجب على المحقق أن يختار معاملتك ويدرجها في كتلة حتى يتمكن من التحقق من المعاملة واعتبارها "ناجحة".
4. مع مرور الوقت، سيتم ترقية الكتلة التي تحتوي على معاملتك إلى "مبررة" ثم "نهائية". هذه الترقيات تجعل من المؤكد
   أن معاملتك كانت ناجحة ولن يتم تغييرها أبدًا. بمجرد "إنهاء" الكتلة، لا يمكن تغييرها إلا
   عن طريق هجوم على مستوى الشبكة سيكلف مليارات الدولارات.

## عرض مرئي {#a-visual-demo}

شاهد أوستن وهو يشرح لك المعاملات والغاز والتعدين.

<YouTube id="er-0ihqFQB0" />

## غلاف المعاملات المكتوبة {#typed-transaction-envelope}

كان لدى الإيثريوم في الأصل تنسيق واحد للمعاملات. تحتوي كل معاملة على رقم عشوائي، وسعر الغاز، وحد الغاز، والعنوان، والقيمة، والبيانات، وv، وr، وs. هذه الحقول [مشفرة بـ RLP](/developers/docs/data-structures-and-encoding/rlp/)، لتبدو شيئًا كهذا:

`RLP([nonce, gasPrice, gasLimit, to, value, data, v, r, s])`

تطور Ethereum لدعم أنواع متعددة من المعاملات للسماح بتنفيذ ميزات جديدة مثل قوائم الوصول و[EIP-1559](https://eips.ethereum.org/EIPS/eip-1559) دون التأثير على تنسيقات المعاملات القديمة.

[EIP-2718](https://eips.ethereum.org/EIPS/eip-2718) هو ما يسمح بهذا السلوك. يتم تفسير المعاملات على النحو التالي:

`TransactionType || TransactionPayload`

حيث يتم تعريف الحقول على النحو التالي:

- `TransactionType` - رقم بين 0 و0x7f، لإجمالي 128 نوعًا ممكنًا من المعاملات.
- `TransactionPayload` - مصفوفة بايت عشوائية يحددها نوع المعاملة.

بناءً على قيمة `TransactionType`، يمكن تصنيف المعاملة على النحو التالي:

1. **معاملات النوع 0 (القديمة):** تنسيق المعاملة الأصلي المستخدم منذ إطلاق Ethereum. لا تتضمن ميزات من [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559) مثل حسابات رسوم الغاز الديناميكية أو قوائم الوصول للعقود الذكية. تفتقر المعاملات القديمة إلى بادئة محددة تشير إلى نوعها في شكلها التسلسلي، بدءًا من البايت `0xf8` عند استخدام تشفير [بادئة الطول المتكرر (RLP)](/developers/docs/data-structures-and-encoding/rlp). قيمة TransactionType لهذه المعاملات هي `0x0`.

2. **معاملات النوع 1:** تم تقديمها في [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930) كجزء من [تطوير برلين](/ethereum-forks/#berlin) لـ Ethereum، وتتضمن هذه المعاملات معلمة `accessList`. تحدد هذه القائمة العناوين ومفاتيح التخزين التي تتوقع المعاملة الوصول إليها، مما يساعد على تقليل تكاليف [الغاز](/developers/docs/gas/) للمعاملات المعقدة التي تتضمن عقودًا ذكية. لا يتم تضمين تغييرات سوق الرسوم EIP-1559 في المعاملات من النوع 1. تتضمن معاملات النوع 1 أيضًا معلمة `yParity`، والتي يمكن أن تكون إما `0x0` أو `0x1`، مما يشير إلى تكافؤ قيمة y لتوقيع secp256k1. يتم التعرف عليها من خلال البدء بالبايت `0x01`، وقيمة TransactionType الخاصة بها هي `0x1`.

3. **معاملات النوع 2**، والتي يشار إليها عادةً باسم معاملات EIP-1559، هي معاملات تم تقديمها في [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559)، في [تطوير لندن](/ethereum-forks/#london) لـ Ethereum. لقد أصبحوا نوع المعاملة القياسي على شبكة Ethereum. تقدم هذه المعاملات آلية جديدة لسوق الرسوم تعمل على تحسين القدرة على التنبؤ من خلال فصل رسوم المعاملة إلى رسوم أساسية ورسوم أولوية. تبدأ بالبايت `0x02` وتتضمن حقولًا مثل `maxPriorityFeePerGas` و `maxFeePerGas`. أصبحت المعاملات من النوع 2 الآن هي الخيار الافتراضي بسبب مرونتها وكفاءتها، وهي مفضلة بشكل خاص خلال فترات الازدحام الشديد في الشبكة لقدرتها على مساعدة المستخدمين في إدارة رسوم المعاملات بشكل أكثر قابلية للتنبؤ. قيمة TransactionType لهذه المعاملات هي `0x2`.

4. **معاملات النوع 3 (Blob)** تم تقديمها في [EIP-4844](https://eips.ethereum.org/EIPS/eip-4844) كجزء من [تطوير Dencun](/ethereum-forks/#dencun) لـ Ethereum. تم تصميم هذه المعاملات للتعامل مع بيانات "blob" (الكائنات الثنائية الكبيرة) بكفاءة أكبر، مما يفيد بشكل خاص عمليات التجميع في الطبقة 2 من خلال توفير طريقة لنشر البيانات على شبكة Ethereum بتكلفة أقل. تتضمن معاملات Blob حقولًا إضافية مثل `blobVersionedHashes` و `maxFeePerBlobGas` و `blobGasPrice`. تبدأ بالبايت `0x03`، وقيمة TransactionType الخاصة بها هي `0x3`. تمثل معاملات Blob تحسنًا كبيرًا في توفر بيانات Ethereum وقدرات التوسع.

5. **معاملات النوع 4** تم تقديمها في [EIP-7702](https://eips.ethereum.org/EIPS/eip-7702) كجزء من [تطوير Pectra](/roadmap/pectra/) لـ Ethereum. صُممت هذه المعاملات لتكون متوافقة مع تجريد الحسابات مستقبلاً. إنها تسمح لحسابات EOA بالتصرف مؤقتًا مثل حسابات العقود الذكية دون المساس بوظائفها الأصلية. تتضمن معلمة `authorization_list`، التي تحدد العقد الذكي الذي يفوض حساب EOA سلطته إليه. بعد المعاملة، سيحتوي حقل النص البرمجي الخاص بـ EOA على عنوان العقد الذكي المفوض.

## قراءة إضافية {#further-reading}

- [EIP-2718: غلاف المعاملات المكتوبة](https://eips.ethereum.org/EIPS/eip-2718)

_هل تعرف أحد الموارد المجتمعية التي ساعدتك؟ عدّل هذه الصفحة وأضفه!_

## المواضيع ذات الصلة {#related-topics}

- [الحسابات](/developers/docs/accounts/)
- [آلة إيثريوم الافتراضية (EVM)](/developers/docs/evm/)
- [الغاز](/developers/docs/gas/)

---
title: 共識機制
description: 解釋分佈式系統中的共識協定及其於以太坊中扮演的角色。
lang: zh-tw
---

「共識機制」一詞常泛指「權益證明」、「工作量證明」或「權威證明」協定。 然而，這些證明方式僅為共識機制當中用來抵禦[女巫攻擊](/glossary/#sybil-attack)的組成部分。 共識機制是由一整套想法、協定和激勵構成的體系，使得一系列分佈式節點能夠就區塊鏈狀態達成一致。

## 基本資訊 {#prerequisites}

為了加深對本頁內容的理解，我們推薦你先仔細閱讀我們的[以太坊介紹](/developers/docs/intro-to-ethereum/)。

## 何為共識？ {#what-is-consensus}

提到共識，我們意指公共合意已被達成。 考慮一群想去看電影的人。 如果他們對於提議「看某部電影」沒有任何異議，那就可以說共識達成了。 如果存在異議，那他們就必須透過某種方法決定要看哪一部電影。 在極端情況下，這群人就會分開。

對於以太坊區塊鏈來說，該過程是標準化的，達成共識意味著全網路中至少 66% 的節點就網路的全域狀態達成一致。

## 何為共識機制？ {#what-is-a-consensus-mechanism}

共識機制一詞是指一整套由協定、激勵和想法構成的體系，使得整個網路的節點能夠就區塊鏈狀態達成一致。

以太坊採用基於權益證明的共識機制，其加密經濟安全性源於對質押者的鎖定資本實施的一系列獎勵和懲罰措施。 這種激勵體系鼓勵各個質押者誠信運作驗證者節點，並懲罰那些有不良行為的質押才，讓攻擊網路的行為付出極為高昂的代價。

還有一個協定，用於規範如何選擇誠實的驗證者，讓它們提議或驗證區塊、處理交易並投票支持其鏈頭部的視圖。 在極少數情況下，如果鏈頭部附近的同一位置存在多個區塊，就會利用一個分叉選擇機制來選擇組成「最重」的鏈的區塊。區塊權重根據為相應區塊投票的驗證者數量進行計算，並按驗證者質押的以太幣餘額進行加權。

有些關於共識的重要概念並未在規範中明確定義，例如由潛在「帶外社交協調」提供的額外安全保障，可作為防禦網路攻擊的最後一道防線。

這些部分共同組成了共識機制。

## 共識機制種類 {#types-of-consensus-mechanisms}

### 基於工作量證明 {#proof-of-work}

和比特幣類似，以太坊也曾經使用基於**工作量證明 (PoW)** 的共識協定。

#### 區塊建立 {#pow-block-creation}

礦工相互競爭以建立包含已處理交易的新區塊。 贏家將與網路其餘部分分享新區塊，並獲得一些新鑄造的以太幣。 解決數學問題速度最快的電腦會在比賽中獲勝。 這會產生當前區塊和之前的區塊之間的加密連結。 解決此數學問題便是「工作量證明」所做的工作。 隨後由一條分叉選擇規則確定規範鏈，該規則會選擇一組在挖礦工作方面做得最多的區塊。

#### 安全性 {#pow-security}

你需要控制 51% 的網路算力才能欺騙網路，這一事實確保了網路安全。 發起攻擊需要鉅額的設備和能源投入；你花費的可能會比你賺的還要多。

更多關於[工作量證明](/developers/docs/consensus-mechanisms/pow/)的資訊

### 基於權益證明 {#proof-of-stake}

以太坊目前使用基於**權益證明 (PoS)** 的共識協定。

#### 區塊生成 {#pos-block-creation}

驗證者建立區塊。 每個時隙都會隨機選擇一個驗證者成為區塊提議者。 區塊提議者的共識用戶端請求配對的執行用戶端對交易打包，作為「執行有效負載」。 然後它們將其包裝成共識資料以形成區塊，再把這個區塊傳送給以太坊網路上的其他節點。 這樣的區塊產生會得到以太幣獎勵。 在極少數情況下，當一個時隙中存在多個可能的區塊，或節點在不同時間收到區塊，分叉選擇演算法就會選擇使形成的鏈具有最大證明權重的區塊（證明權重是指提供證明的驗證者數量，並按驗證者質押的以太幣餘額進行調整）。

#### 安全性 {#pos-security}

權益證明系統以加密經濟的方式保障安全，因為攻擊者若試圖控制整個鏈，就必須銷毀大量以太幣。 獎勵機制會獎勵誠實行事的質押者，而懲罰機制則會抑制質押者做出惡意行為。

更多關於[權益證明](/developers/docs/consensus-mechanisms/pos/)的資訊

### 視覺導覽 {#types-of-consensus-video}

觀看以太坊上所用不同類型之共識機制的更多資訊：

<YouTube id="ojxfbN78WFQ" />

### 抵禦女巫攻擊與區塊鏈選擇 {#sybil-chain}

僅僅工作量證明和權益證明還不能構成共識協定，但為了簡便起見，通常將它們稱為共識協定。 它們實際是抵禦女巫攻擊機制及區塊鏈創作者選擇程式；提供了一種方法來決定誰能成為最新區塊創作者。 另一個重要組成部分是鏈選擇（又稱分叉選擇）演算法，在同一位置有多個區塊的情況下，它讓節點可以在鏈頭部選擇一個正確的區塊。

**抵禦女巫攻擊**衡量協定有效對抗女巫攻擊的能力。 抵禦此類攻擊對於去中心化區塊鏈至關緊要，可使所有礦工與驗證者能夠基於其投入的資源平等地獲得獎勵。 工作量證明及權益證明透過讓使用者耗費大量能源或投入大量抵押，來防範此類攻擊。 此類保護會對女巫攻擊形成經濟上的威懾。

**區塊鏈選擇規則**被用來決定哪條鏈為「正確」的鏈。 比特幣使用「最長鏈」規則。這意味著，任何最長的區塊鏈，都會被其他節點接受並與之合作。 對於工作量證明區塊鏈，最長鏈取決於該鏈所累積之工作量證明總難度。 以太坊也曾經用過最長鏈規則；但現在以太坊在權益證明機制下運作，採用了經過更新的分叉選擇演算法來衡量鏈的「權重」。 權重是累積的驗證者投票數累積總和，並以驗證者質押的以太幣餘額進行加權。

以太坊使用一種被稱為 [Gasper](/developers/docs/consensus-mechanisms/pos/gasper/) 的共識機制，它結合了 [Casper 友善最終確定性組件權益證明](https://arxiv.org/abs/1710.09437)和[最貪婪最重觀測子樹 (GHOST) 分叉選擇規則](https://arxiv.org/abs/2003.03052)。

## 衍生閱讀 {#further-reading}

- [何為區塊鏈共識演算法？](https://academy.binance.com/en/articles/what-is-a-blockchain-consensus-algorithm)
- [何為 Nakamoto 共識？ 完整初學者指南](https://blockonomi.com/nakamoto-consensus/)
- [Casper 機制如何運作？](https://medium.com/unitychain/intro-to-casper-ffg-9ed944d98b2d)
- [關於權益證明區塊鏈的安全性及效能](https://eprint.iacr.org/2016/555.pdf)
- [拜占庭問題](https://en.wikipedia.org/wiki/Byzantine_fault)

_知道一個曾經幫助你學習更多社區或社團資源? 歡迎在本頁自由編輯或添加內容！！_

## 相關主題 {#related-topics}

- [工作量證明](/developers/docs/consensus-mechanisms/pow/)
- [挖礦](/developers/docs/consensus-mechanisms/pow/mining/)
- [持有量證明（又稱：權益證明）](/developers/docs/consensus-mechanisms/pos/)
- [權威證明](/developers/docs/consensus-mechanisms/poa/)
